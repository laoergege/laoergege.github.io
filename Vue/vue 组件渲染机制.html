<!DOCTYPE html>
<html lang="zh-CN" data-theme="cupcake">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.46">
    <link rel="manifest" href="/site.webmanifest.json"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><title>Vue ç»„ä»¶æ¸²æŸ“æœºåˆ¶ | </title><meta name="description" content="Just For Fun">
    <link rel="preload" href="/assets/js/runtime~app.7d4bd660.js" as="script"><link rel="preload" href="/assets/css/styles.1c65b737.css" as="style"><link rel="preload" href="/assets/js/5838.13a569e5.js" as="script"><link rel="preload" href="/assets/js/app.7e792774.js" as="script"><link rel="prefetch" href="/assets/js/v-03fc2322.47d94022.js"><link rel="prefetch" href="/assets/js/v-ba2c1988.3632b5e0.js"><link rel="prefetch" href="/assets/js/v-fd8e5af2.a9cafb88.js"><link rel="prefetch" href="/assets/js/v-5a071f34.190f1fdc.js"><link rel="prefetch" href="/assets/js/v-317472f1.a3c9dba2.js"><link rel="prefetch" href="/assets/js/v-560b844b.09f8a065.js"><link rel="prefetch" href="/assets/js/v-85bc3e4c.27575d9e.js"><link rel="prefetch" href="/assets/js/v-4835f72d.209f9a9b.js"><link rel="prefetch" href="/assets/js/v-6f2abf9c.c6a52b82.js"><link rel="prefetch" href="/assets/js/v-32c68258.46247de2.js"><link rel="prefetch" href="/assets/js/v-04983e79.ae40370a.js"><link rel="prefetch" href="/assets/js/v-7269d92e.00653b56.js"><link rel="prefetch" href="/assets/js/v-54e51afe.e3f20358.js"><link rel="prefetch" href="/assets/js/v-5fbdabee.afcc17b5.js"><link rel="prefetch" href="/assets/js/v-928f5a14.0a4a3dc4.js"><link rel="prefetch" href="/assets/js/v-88c7f226.529f6212.js"><link rel="prefetch" href="/assets/js/v-5e99732b.68dd2407.js"><link rel="prefetch" href="/assets/js/v-2fc78b4d.97b37f50.js"><link rel="prefetch" href="/assets/js/v-d99bba28.2cf82742.js"><link rel="prefetch" href="/assets/js/v-bee2f4a8.f072eb83.js"><link rel="prefetch" href="/assets/js/v-57ad8616.44af159f.js"><link rel="prefetch" href="/assets/js/v-f701b528.aa7f8f17.js"><link rel="prefetch" href="/assets/js/v-093d016d.bc725dd1.js"><link rel="prefetch" href="/assets/js/v-06ed95cc.0db5595a.js"><link rel="prefetch" href="/assets/js/v-01b20944.db789013.js"><link rel="prefetch" href="/assets/js/v-137d7552.50039c10.js"><link rel="prefetch" href="/assets/css/5045.styles.72ac531f.css"><link rel="prefetch" href="/assets/js/v-631fc68a.80740d81.js"><link rel="prefetch" href="/assets/js/v-8b5f7690.191ba9a3.js"><link rel="prefetch" href="/assets/js/v-530f22f6.f8e361fa.js"><link rel="prefetch" href="/assets/js/v-be2646cc.549f65bf.js"><link rel="prefetch" href="/assets/js/v-75e44f07.2f8601c3.js"><link rel="prefetch" href="/assets/js/v-c2504efe.28c55f92.js"><link rel="prefetch" href="/assets/js/v-5bc51cd9.b23c2caa.js"><link rel="prefetch" href="/assets/js/5956.f176ea33.js"><link rel="prefetch" href="/assets/js/v-6dc8e518.a8181c32.js"><link rel="prefetch" href="/assets/js/v-568d3b89.483d19f1.js"><link rel="prefetch" href="/assets/js/v-743faa02.3247db36.js"><link rel="prefetch" href="/assets/js/v-d52c6cc0.34d4b256.js"><link rel="prefetch" href="/assets/js/v-78263bfa.b7cb21e4.js"><link rel="prefetch" href="/assets/js/v-199de1f8.16ad6f91.js"><link rel="prefetch" href="/assets/js/v-30078430.3079f1d2.js"><link rel="prefetch" href="/assets/js/v-240dbb06.02e786fb.js"><link rel="prefetch" href="/assets/js/v-7a102f72.94a1b7e7.js"><link rel="prefetch" href="/assets/js/v-1402111c.9dc8cc11.js"><link rel="prefetch" href="/assets/js/v-f2bbc8da.fc4d9aa5.js"><link rel="prefetch" href="/assets/js/v-b0176dc2.b994ff0c.js"><link rel="prefetch" href="/assets/js/4644.1787b6ff.js"><link rel="prefetch" href="/assets/js/v-a5da5a08.cc633de8.js"><link rel="prefetch" href="/assets/js/v-acadbc84.800a32fa.js"><link rel="prefetch" href="/assets/js/v-a270a8ca.ea9c331c.js"><link rel="prefetch" href="/assets/js/v-a9440b46.63ee3544.js"><link rel="prefetch" href="/assets/js/6929.46233b49.js"><link rel="prefetch" href="/assets/js/9840.789f773b.js"><link rel="prefetch" href="/assets/js/v-9f06f78c.ff18832e.js"><link rel="prefetch" href="/assets/js/9870.c84a31ac.js"><link rel="prefetch" href="/assets/js/v-8daa1a0e.8245b191.js"><link rel="prefetch" href="/sw.js"><link rel="prefetch" href="/assets/css/3859.styles.7057c730.css">
    <link rel="stylesheet" href="/assets/css/styles.1c65b737.css">
</head>

<body>
    <div id="app"><!--[--><!--[--><div class="navbar sticky top-0 z-10"><a href="/" class=""><label class="btn btn-circle avatar"><div class="rounded-full ring ring-white shadow-2xl no-zoom"><img src="/avatar.webp"></div></label></a></div><div class="min-h-screen flex justify-center flex-col items-center"><article class="article w-full sm:w-3/4 lg:w-2/3 p-4" data-theme="cupcake"><div class="sm:max-w-full pb-12 prose sm:prose-sm md:prose-lg dark:prose-invert"><h1 id="vue-ç»„ä»¶æ¸²æŸ“æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#vue-ç»„ä»¶æ¸²æŸ“æœºåˆ¶" aria-hidden="true">#</a> Vue ç»„ä»¶æ¸²æŸ“æœºåˆ¶</h1><blockquote><p>ä»¥ä¸‹ç¤ºä¾‹ä»£ç åŸºäº vue3.0ã€vue3.2ï¼ˆåç»­ä¿®æ”¹ï¼‰</p></blockquote><p>ä»»ä½•å‰ç«¯æ¡†æ¶ï¼Œæœ€ä¸»è¦çš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯æ¸²æŸ“è§†å›¾ã€‚åœ¨ Vue ä¸­ï¼Œæ•´ä¸ªåº”ç”¨çš„é¡µé¢éƒ½æ˜¯é€šè¿‡<strong>ç»„ä»¶</strong>æ¥æ„æˆå¹¶æ¸²æŸ“æˆé¡µé¢ã€‚</p><p><img src="/assets/img/1281db002d7238b2948c8b50b3bb8882d7353ff9248c5f3049de3d0e3277a27d.aaf85a67.png" alt="picture 2"></p><p>åœ¨äº†è§£ vue ç»„ä»¶ä¹‹å‰ï¼Œå…ˆäº†è§£ VirtualDOMï¼ˆåœ¨ vue ä¸­åˆ™ç§°ä¸º vnodeï¼‰ã€‚</p><h2 id="vnode" tabindex="-1"><a class="header-anchor" href="#vnode" aria-hidden="true">#</a> VNode</h2><p>Vue çš„æ¸²æŸ“åŸç†ä¸­ä½¿ç”¨ <strong>VirtualDOM æœºåˆ¶</strong>ï¼Œ<strong>VirtualDOM æœ¬è´¨ä¸Šæ˜¯ç”¨æ¥æè¿°çœŸå® DOM çš„ JavaScript å¯¹è±¡</strong>ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª vnode å¯¹è±¡å»è¡¨ç¤º<code>&lt;button&gt;</code>èŠ‚ç‚¹ã€‚ä¸€ä¸ª VNode çš„å±æ€§æœ€ä¸»è¦çš„æ˜¯èŠ‚ç‚¹ç±»å‹ <code>type</code>ï¼ŒèŠ‚ç‚¹å±æ€§ <code>props</code>ï¼Œå­—èŠ‚ç‚¹ <code>children</code>ã€‚</p><div class="language-html ext-html"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292F;">&lt;</span><span style="color:#116329;">button</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">class</span><span style="color:#24292F;">=</span><span style="color:#0A3069;">&quot;btn&quot;</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">style</span><span style="color:#24292F;">=</span><span style="color:#0A3069;">&quot;</span><span style="color:#24292F;">width:100px;height:50px&quot;</span><span style="color:#24292F;">&gt;click me&lt;/</span><span style="color:#116329;">button</span><span style="color:#24292F;">&gt;</span></span>
<span class="line"></span></code></pre></div><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">vnode</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">  type: </span><span style="color:#0A3069;">&quot;button&quot;</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  props: {</span></span>
<span class="line"><span style="color:#24292F;">    class: </span><span style="color:#0A3069;">&quot;btn&quot;</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    style: {</span></span>
<span class="line"><span style="color:#24292F;">      width: </span><span style="color:#0A3069;">&quot;100px&quot;</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">      height: </span><span style="color:#0A3069;">&quot;50px&quot;</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    },</span></span>
<span class="line"><span style="color:#24292F;">  },</span></span>
<span class="line"><span style="color:#24292F;">  children: </span><span style="color:#0A3069;">&quot;click me&quot;</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span></code></pre></div><p>å¼•å…¥ VNode çš„å¥½å¤„ï¼š</p><ol><li>ä»»ä½•å¸¸è§„çš„ GUI éƒ½èƒ½ç”¨<strong>ç±» DOM æ•°æ®ç»“æ„</strong>å»æè¿°ï¼Œå¼•å…¥ VNode ä¸»è¦æ˜¯å°†è§†å›¾<strong>æŠ½è±¡åŒ–</strong>ï¼Œæä¾›äº†<strong>è·¨å¹³å°</strong>èƒ½åŠ›</li><li><strong>UI is a value</strong> ï¼šæŠŠè§†å›¾å½“ä½œä¸€ç§å˜é‡å€¼ï¼Œèƒ½å¤Ÿè¿›è¡Œ<strong>ç¼–ç¨‹åŒ–</strong></li><li>åŸºäºè™šæ‹Ÿ DOM å®ç°çŠ¶æ€é©±åŠ¨çš„ UI å¼€å‘æ–¹å¼ï¼šé¿å…äº†æ‰‹åŠ¨æ“ä½œ DOM æ•ˆç‡ä½ä¸‹ä»¥åŠè§„é¿ XSS é£é™©</li></ol><p>vue è¿˜æä¾›å¾ˆå¤šçš„ VNode ç±»å‹ï¼š</p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#6E7781;">// packages/runtime-core/src/vnode.ts</span></span>
<span class="line"><span style="color:#CF222E;">export</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">type</span><span style="color:#24292F;"> </span><span style="color:#953800;">VNodeTypes</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">string</span><span style="color:#24292F;"> </span><span style="color:#6E7781;">// element</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#953800;">VNode</span><span style="color:#24292F;"> </span><span style="color:#6E7781;">// slot</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#953800;">Component</span><span style="color:#24292F;"> </span><span style="color:#6E7781;">// ç»„ä»¶</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">typeof</span><span style="color:#24292F;"> Text </span><span style="color:#6E7781;">// æ–‡æœ¬</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">typeof</span><span style="color:#24292F;"> Static </span><span style="color:#6E7781;">// é™æ€</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">typeof</span><span style="color:#24292F;"> Comment </span><span style="color:#6E7781;">// æ³¨é‡Š</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">typeof</span><span style="color:#24292F;"> Fragment </span><span style="color:#6E7781;">// ç‰‡æ®µ</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">typeof</span><span style="color:#24292F;"> TeleportImpl </span><span style="color:#6E7781;">// ä¼ é€ç»„ä»¶</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">typeof</span><span style="color:#24292F;"> SuspenseImpl </span><span style="color:#6E7781;">// æŒ‚è½½ç»„ä»¶</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">export</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">interface</span><span style="color:#24292F;"> </span><span style="color:#953800;">VNode</span><span style="color:#24292F;">&lt;</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">HostNode</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">RendererNode</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">HostElement</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#953800;">RendererElement</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">ExtraProps</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> { [</span><span style="color:#953800;">key</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">string</span><span style="color:#24292F;">]</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">any</span><span style="color:#24292F;"> }</span></span>
<span class="line"><span style="color:#24292F;">&gt; {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">type</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">VNodeTypes</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">props</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> (</span><span style="color:#953800;">VNodeProps</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">&amp;</span><span style="color:#24292F;"> </span><span style="color:#953800;">ExtraProps</span><span style="color:#24292F;">) </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">children</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">VNodeNormalizedChildren</span></span>
<span class="line"><span style="color:#24292F;">	</span><span style="color:#CF222E;">...</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="vue-ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#vue-ç»„ä»¶" aria-hidden="true">#</a> Vue ç»„ä»¶</h2><p>ç»„ä»¶æ˜¯ä¸€ç§æŠ½è±¡æ¦‚å¿µã€ä¸€ç§å¤ç”¨æ‰‹æ®µã€‚</p><p>å‰ç«¯é¢†åŸŸçš„ç»„ä»¶åŒ–ï¼Œå³ä»¥è§†å›¾ä¸ºå•ä½è¿›è¡Œé¡µé¢é€»è¾‘åˆ†å‰²åŠå¤ç”¨ï¼Œç»„ä»¶ = è§†å›¾æ¨¡æ¿ + é€»è¾‘çŠ¶æ€ã€‚</p><blockquote><p>ä½†æ˜¯ä»¥è¿™æ ·çš„ç»„ä»¶ä¸ºåŸºæœ¬å¤ç”¨å•ä½ï¼Œåœ¨å‰ç«¯é¢†åŸŸä½ ä¼šå‘ç°å¾ˆéš¾å¤ç”¨ã€‚æœ‰æ—¶è§†å›¾æ¨¡æ¿ç¬¦åˆäº†ä½†é€»è¾‘çŠ¶æ€ç¨å¾®å¾—ä¿®æ”¹ï¼Œä»£ç åªä¼šåŠ å…¥æ›´å¤šçš„ case by caseï¼›æœ‰æ—¶é€»è¾‘çŠ¶æ€ç¬¦åˆäº†ä½†æ¨¡æ¿æ ·å¼å´ä¸ç¬¦åˆ UI éœ€æ±‚ï¼Œè¿™å°±å¯¼è‡´å‰ç«¯ç»„ä»¶å¾€å¾€é™äºä¸€å®šçš„åœºæ™¯ã€‚</p><p>æœ€ä½³å½¢å¼æ˜¯ç»„ä»¶æ˜¯è§†å›¾æ„æˆåŸºæœ¬å•ä½ã€è§†å›¾æ¨¡æ¿ä¸é€»è¾‘çŠ¶æ€æ˜¯æœ€å°å¤ç”¨å•ä½ ğŸ¤”ã€‚</p></blockquote><p>åŸºäº VirtualDOM æœºåˆ¶ï¼Œ<strong>ç»„ä»¶æœ¬è´¨ä¸Šä¸»è¦æ˜¯å¯¹äº§ç”Ÿ vdom çš„é€»è¾‘çš„å°è£…</strong>ã€‚ä¸€ä¸ª Vue ç»„ä»¶çš„ä¸»è¦æ„æˆåˆ†å±‚ï¼š</p><p><img src="/assets/img/1657120024564.5bdc5ae6.png" alt="å›¾ 2"></p><p>æ¯ä¸€å±‚çš„æ•°æ®æµä¾èµ–éƒ½æ˜¯è‡ªé¡¶å‘ä¸‹ï¼š</p><ol><li>props/provide å¤–éƒ¨å¯¹ç»„ä»¶çš„è¾“å…¥</li><li>setup(data) ç»„ä»¶å†…éƒ¨é€»è¾‘ç»„ç»‡ã€è§†å›¾çŠ¶æ€è¾“å‡º</li><li>render è§†å›¾æ¸²æŸ“ï¼Œè¾“å‡º vdom</li><li>slots å¯¹å¤–éƒ¨æä¾›è‡ªå®šä¹‰æ¸²æŸ“æ¥å£</li></ol><h3 id="åŸºäº-virtualdom-çš„ç»„ä»¶æ¸²æŸ“æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#åŸºäº-virtualdom-çš„ç»„ä»¶æ¸²æŸ“æœºåˆ¶" aria-hidden="true">#</a> åŸºäº VirtualDOM çš„ç»„ä»¶æ¸²æŸ“æœºåˆ¶</h3><p>æ— è®ºæ˜¯ Vue æˆ–è€… Reactï¼ŒåŸºäº VirtualDOM çš„æ•°æ®é©±åŠ¨æ¡†æ¶åŸç†åŸºæœ¬æœ‰ä»¥ä¸‹å‡ ä¸ªé‡è¦æ­¥éª¤ï¼š</p><p><img src="/assets/img/1657525936169.64c59c19.png" alt="å›¾ 5"></p><ol><li>æ•°æ®å˜åŠ¨ï¼ˆæˆ–è€…åˆå§‹æ•°æ®ï¼‰</li><li>Renderï¼šè°ƒåº¦ Render è¾“å‡ºæ–° vdom</li><li>Diffï¼š</li><li>Patchï¼šæ‰§è¡Œç³»ç»Ÿå¹³å°å¯¹åº”çš„æ¸²æŸ“å‘½ä»¤</li></ol><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> { createVNode, patch, h } </span><span style="color:#CF222E;">from</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;vue&quot;</span><span style="color:#24292F;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6E7781;">// 1. ç»„ä»¶å®šä¹‰</span></span>
<span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">CustomComponent</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">  props: {</span></span>
<span class="line"><span style="color:#24292F;">    name: </span><span style="color:#0550AE;">String</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  },</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#8250DF;">setup</span><span style="color:#24292F;">(</span><span style="color:#953800;">props</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">      resolveName: </span><span style="color:#0A3069;">`hello ${</span><span style="color:#24292F;">props</span><span style="color:#0A3069;">.</span><span style="color:#24292F;">name</span><span style="color:#0A3069;">}`</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    };</span></span>
<span class="line"><span style="color:#24292F;">  },</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#8250DF;">render</span><span style="color:#24292F;">() {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">h</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;div&quot;</span><span style="color:#24292F;">, [</span><span style="color:#0550AE;">this</span><span style="color:#24292F;">.resolveName, </span><span style="color:#0550AE;">this</span><span style="color:#24292F;">.$slots.</span><span style="color:#8250DF;">default</span><span style="color:#24292F;">()]);</span></span>
<span class="line"><span style="color:#24292F;">  },</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6E7781;">// 2. åˆ›å»ºç»„ä»¶çš„ vnode</span></span>
<span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">vnode</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">createVNode</span><span style="color:#24292F;">(</span></span>
<span class="line"><span style="color:#24292F;">  CustomComponent,</span></span>
<span class="line"><span style="color:#24292F;">  { name: </span><span style="color:#0A3069;">&quot;world&quot;</span><span style="color:#24292F;"> },</span></span>
<span class="line"><span style="color:#24292F;">  {</span></span>
<span class="line"><span style="color:#24292F;">    default: </span><span style="color:#0A3069;">&quot;!&quot;</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"><span style="color:#24292F;">);</span></span>
<span class="line"><span style="color:#6E7781;">// vnode</span></span>
<span class="line"><span style="color:#6E7781;">//{</span></span>
<span class="line"><span style="color:#6E7781;">//  type: CustomComponent,</span></span>
<span class="line"><span style="color:#6E7781;">//  props: {</span></span>
<span class="line"><span style="color:#6E7781;">//    name: &#39;test&#39;</span></span>
<span class="line"><span style="color:#6E7781;">//  },</span></span>
<span class="line"><span style="color:#6E7781;">//  children: &#39;!&#39;</span></span>
<span class="line"><span style="color:#6E7781;">//}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6E7781;">// 3. æ¸²æŸ“ vnodeï¼ˆpatch vnodeï¼‰</span></span>
<span class="line"><span style="color:#8250DF;">render</span><span style="color:#24292F;">(vnode, document.</span><span style="color:#8250DF;">querySelector</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&quot;#app&quot;</span><span style="color:#24292F;">));</span></span>
<span class="line"><span style="color:#CF222E;">function</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">render</span><span style="color:#24292F;">(</span><span style="color:#953800;">vnode</span><span style="color:#24292F;">, </span><span style="color:#953800;">container</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// path é‡Œä¼šè°ƒç”¨ç»„ä»¶çš„ renderï¼Œä¸‹é¢æºç åˆ†æ</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// old vnode åˆå§‹ä¸º nullï¼Œæ„å‘³è¿™æ˜¯åˆå§‹æ¸²æŸ“ï¼Œæ‰§è¡ŒæŒ‚è½½æ“ä½œ</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#8250DF;">patch</span><span style="color:#24292F;">(vnode, </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">, container)</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6E7781;">// &lt;div&gt;hello world!&lt;/div&gt;</span></span>
<span class="line"></span></code></pre></div><h2 id="vue-ç»„ä»¶æ¸²æŸ“æµç¨‹æºç åˆ†æ" tabindex="-1"><a class="header-anchor" href="#vue-ç»„ä»¶æ¸²æŸ“æµç¨‹æºç åˆ†æ" aria-hidden="true">#</a> vue ç»„ä»¶æ¸²æŸ“æµç¨‹æºç åˆ†æ</h2><p>æ¸²æŸ“æµç¨‹åˆ†åˆå§‹æ¸²æŸ“å’Œæ›´æ–°æ¸²æŸ“ï¼Œä¸‹é¢æºç åˆ†æå…ˆä»åˆå§‹æ¸²æŸ“æµç¨‹ã€‚</p><h3 id="åˆ›å»ºåº”ç”¨å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºåº”ç”¨å¯¹è±¡" aria-hidden="true">#</a> åˆ›å»ºåº”ç”¨å¯¹è±¡</h3><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#6E7781;">// åœ¨ Vue3 ä¸­ï¼Œä¸€ä¸ª vue åº”ç”¨åˆ›å»ºæ ‡å‡†æµç¨‹å¦‚ä¸‹</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> { createApp } </span><span style="color:#CF222E;">from</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&#39;vue&#39;</span></span>
<span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> App </span><span style="color:#CF222E;">from</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&#39;./app&#39;</span></span>
<span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">app</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">createApp</span><span style="color:#24292F;">(App)</span></span>
<span class="line"><span style="color:#24292F;">app.</span><span style="color:#8250DF;">mount</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&#39;#app&#39;</span><span style="color:#24292F;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">-------------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6E7781;">// runtime-dom åŒ…ä¸­åŒ…å«äº† web å¹³å°çš„æ¸²æŸ“å™¨</span></span>
<span class="line"><span style="color:#6E7781;">// packages/runtime-dom/src/index.ts</span></span>
<span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">createApp</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> ((</span><span style="color:#CF222E;">...</span><span style="color:#953800;">args</span><span style="color:#24292F;">) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// 1. åˆ›å»º web æ¸²æŸ“å™¨ã€åˆ›å»º app å¯¹è±¡</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">app</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">ensureRenderer</span><span style="color:#24292F;">().</span><span style="color:#8250DF;">createApp</span><span style="color:#24292F;">(</span><span style="color:#CF222E;">...</span><span style="color:#24292F;">args)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> { </span><span style="color:#0550AE;">mount</span><span style="color:#24292F;"> } </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// é‡å†™ mount æ–¹æ³•</span></span>
<span class="line"><span style="color:#24292F;">  app.</span><span style="color:#8250DF;">mount</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (</span><span style="color:#953800;">containerOrSelector</span><span style="color:#24292F;">) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">container</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">normalizeContainer</span><span style="color:#24292F;">(containerOrSelector)</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// 2. è°ƒç”¨ app.mount æ ¸å¿ƒæ ‡å‡†æ–¹æ³•ï¼Œåˆ›å»º vnode, æ¸²æŸ“ vnode</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">mount</span><span style="color:#24292F;">(container)</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// ...</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> app</span></span>
<span class="line"><span style="color:#24292F;">})</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h4 id="æ¸²æŸ“å™¨-renderer" tabindex="-1"><a class="header-anchor" href="#æ¸²æŸ“å™¨-renderer" aria-hidden="true">#</a> æ¸²æŸ“å™¨ renderer</h4><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#6E7781;">// packages/runtime-dom/src/index.ts</span></span>
<span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">app</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">ensureRenderer</span><span style="color:#24292F;">().</span><span style="color:#8250DF;">createApp</span><span style="color:#24292F;">(</span><span style="color:#CF222E;">...</span><span style="color:#24292F;">args); </span><span style="color:#6E7781;">// å»¶è¿Ÿåˆ›å»ºæ¸²æŸ“ï¼Œæ–¹ä¾¿ tree-shakable</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6E7781;">// åˆ›å»ºè‡ªå®šä¹‰æ¸²æŸ“å™¨</span></span>
<span class="line"><span style="color:#6E7781;">// vue ä¸ºäº†è·¨å¹³å°æ”¯æŒï¼ŒæŠ½è±¡æ ‡å‡†åŒ–æ¸²æŸ“å™¨çš„å¹³å°æ¸²æŸ“æ¥å£ã€‚</span></span>
<span class="line"><span style="color:#6E7781;">// renderer = createRenderer(nodeOps)</span></span>
<span class="line"><span style="color:#CF222E;">function</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">ensureRenderer</span><span style="color:#24292F;">() {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> (</span></span>
<span class="line"><span style="color:#24292F;">    renderer </span><span style="color:#CF222E;">||</span><span style="color:#24292F;"> ((renderer </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> createRenderer </span><span style="color:#CF222E;">&lt;</span><span style="color:#24292F;"> Node), Element </span><span style="color:#CF222E;">&gt;</span><span style="color:#24292F;"> rendererOptions)</span></span>
<span class="line"><span style="color:#24292F;">  );</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6E7781;">// å®ç°ä¸åŒå¹³å°çš„æ¸²æŸ“æ“ä½œæ¥å£</span></span>
<span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">rendererOptions</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">extend</span><span style="color:#24292F;">({ patchProp, forcePatchProp }, nodeOps);</span></span>
<span class="line"></span></code></pre></div><p>nodeOps(packages/runtime-dom/src/nodeOps.ts)ï¼Œå®ç°äº† web å¹³å°ä¸‹çš„æ¸²æŸ“æ¥å£ã€‚é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰æ¸²æŸ“å™¨æˆ‘ä»¬å¯ä»¥å®ç°ä¸åŒå¹³å°ä¸‹çš„æ¸²æŸ“ã€‚</p><p><img src="/assets/img/ed6e1c8d4a17343bfaba663aeead7351695e7aab510b56a6a390153715c25438.87a59aee.png" alt="å›¾ 2"></p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#6E7781;">// packages/runtime-core/src/renderer.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6E7781;">// createRenderer æ˜¯ vue è‡ªå®šä¹‰æ¸²æŸ“å™¨çš„æ ¸å¿ƒæ–¹æ³•</span></span>
<span class="line"><span style="color:#CF222E;">function</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">createRenderer</span><span style="color:#24292F;">(</span><span style="color:#953800;">nodeOps</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">baseCreateRenderer</span><span style="color:#24292F;">(nodeOps);</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">function</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">baseCreateRenderer</span><span style="color:#24292F;">(</span><span style="color:#953800;">nodeOps</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">//æ¥å£å®šä¹‰</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">remove</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">RemoveFn</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (</span><span style="color:#953800;">vnode</span><span style="color:#24292F;">) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// æ¥å£è°ƒç”¨</span></span>
<span class="line"><span style="color:#24292F;">    nodeOps.</span><span style="color:#8250DF;">remove</span><span style="color:#24292F;">();</span></span>
<span class="line"><span style="color:#24292F;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">//...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// åˆ©ç”¨é—­åŒ…ï¼Œå°† nodeOps ä¿å­˜ä¸‹æ¥</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">function</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">render</span><span style="color:#24292F;">(</span><span style="color:#953800;">vnode</span><span style="color:#24292F;">, </span><span style="color:#953800;">container</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// ç»„ä»¶æ¸²æŸ“çš„æ ¸å¿ƒé€»è¾‘</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">patch</span><span style="color:#24292F;">(vnode, container);</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// è¿”å›åŒ…å« render æ–¹æ³•çš„æ¸²æŸ“å™¨</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    render,</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// createAppAPI åˆ›å»º createApp</span></span>
<span class="line"><span style="color:#24292F;">    createApp: </span><span style="color:#8250DF;">createAppAPI</span><span style="color:#24292F;">(render),</span></span>
<span class="line"><span style="color:#24292F;">  };</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre></div><p>é™¤äº†å°†æ¸²æŸ“å™¨è·¨å¹³å°æ¸²æŸ“æ ‡å‡†åŒ–ï¼Œè¿˜å°†åº”ç”¨åˆ›å»ºæµç¨‹ä¹Ÿæ ‡å‡†åŒ–ã€‚</p><h4 id="createappapi" tabindex="-1"><a class="header-anchor" href="#createappapi" aria-hidden="true">#</a> createAppAPI</h4><p>ç›¸æ¯”ä»¥å‰ä½¿ç”¨æ’ä»¶ã€æŒ‚è½½å…¨å±€å±æ€§æ–¹æ³•éƒ½è½åˆ° Vue æ„é€ å‡½æ•°å’ŒåŸå‹ä¸Šï¼ŒcreateApp åˆ›å»ºä¸€ä¸ªåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå…è®¸æˆ‘ä»¬åˆ›å»ºå¤šä¸ª vue åº”ç”¨å¹¶è¿›è¡Œå…¨å±€é…ç½®éš”ç¦»ã€‚</p><p>createApp å‡½æ•°å†…éƒ¨çš„ app.mount æ–¹æ³•æ˜¯ä¸€ä¸ªæ ‡å‡†çš„è·¨å¹³å°çš„ç»„ä»¶æ¸²æŸ“æµç¨‹ï¼š<strong>å…ˆåˆ›å»º vnodeï¼Œå†æ¸²æŸ“ vnodeï¼Œç”Ÿæˆ DOM</strong>ã€‚</p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#6E7781;">// Vue.js åˆ©ç”¨é—­åŒ…å’Œå‡½æ•°æŸ¯é‡ŒåŒ–ï¼ŒcreateAppAPI åŒ…è£… render</span></span>
<span class="line"><span style="color:#CF222E;">function</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">createAppAPI</span><span style="color:#24292F;">(</span><span style="color:#953800;">render</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// createApp createApp æ–¹æ³•æ¥å—çš„ä¸¤ä¸ªå‚æ•°ï¼šæ ¹ç»„ä»¶çš„å¯¹è±¡å’Œ prop</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">function</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">createApp</span><span style="color:#24292F;">(</span><span style="color:#953800;">rootComponent</span><span style="color:#24292F;">, </span><span style="color:#953800;">rootProps</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">app</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">      _component: rootComponent,</span></span>
<span class="line"><span style="color:#24292F;">      _props: rootProps,</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#8250DF;">mount</span><span style="color:#24292F;">(</span><span style="color:#953800;">rootContainer</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#6E7781;">// åˆ›å»ºæ ¹ç»„ä»¶çš„ vnode</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">vnode</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">createVNode</span><span style="color:#24292F;">(rootComponent, rootProps);</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#6E7781;">// è°ƒç”¨æ¸²æŸ“å™¨çš„ render vnode</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#8250DF;">render</span><span style="color:#24292F;">(vnode, rootContainer);</span></span>
<span class="line"><span style="color:#24292F;">        app._container </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> rootContainer;</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> vnode.component.proxy;</span></span>
<span class="line"><span style="color:#24292F;">      },</span></span>
<span class="line"><span style="color:#24292F;">    };</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> app;</span></span>
<span class="line"><span style="color:#24292F;">  };</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre></div><p>è¿™é‡Œçš„ä»£ç çš„æ‰§è¡Œé€»è¾‘éƒ½æ˜¯ä¸å¹³å°æ— å…³çš„ï¼Œå¯åŠ¨æ ‡å‡†æ¸²æŸ“æµç¨‹ã€‚å¦‚æœæœ‰éœ€è¦å¯ä»¥åœ¨å¤–éƒ¨é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œæ¥å®Œå–„ç‰¹å®šå¹³å°ä¸‹çš„æ¸²æŸ“é€»è¾‘ã€‚</p><p>æ¯”å¦‚ web å¹³å°ï¼š</p><div class="language-typescript ext-ts"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#6E7781;">// packages/runtime-dom/src/index.ts</span></span>
<span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> { </span><span style="color:#0550AE;">mount</span><span style="color:#24292F;"> } </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> app</span></span>
<span class="line"><span style="color:#24292F;">  app.</span><span style="color:#8250DF;">mount</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (</span><span style="color:#953800;">containerOrSelector</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">Element</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#953800;">ShadowRoot</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">string</span><span style="color:#24292F;">)</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">any</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// æ ‡å‡†åŒ– root el è·å–</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">container</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">normalizeContainer</span><span style="color:#24292F;">(containerOrSelector)</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (</span><span style="color:#CF222E;">!</span><span style="color:#24292F;">container) </span><span style="color:#CF222E;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">component</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> app._component</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// æ”¯æŒ html root å…ƒç´ ä½œä¸º template</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (</span><span style="color:#CF222E;">!</span><span style="color:#8250DF;">isFunction</span><span style="color:#24292F;">(component) </span><span style="color:#CF222E;">&amp;&amp;</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">!</span><span style="color:#24292F;">component.render </span><span style="color:#CF222E;">&amp;&amp;</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">!</span><span style="color:#24292F;">component.template) {</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#6E7781;">// __UNSAFE__</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#6E7781;">// Reason: potential execution of JS expressions in in-DOM template.</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#6E7781;">// The user must make sure the in-DOM template is trusted. If it&#39;s</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#6E7781;">// rendered by the server, the template should not contain any user data.</span></span>
<span class="line"><span style="color:#24292F;">      component.template </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> container.innerHTML</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// clear content before mounting</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// æ¸…é™¤ root å†…å®¹</span></span>
<span class="line"><span style="color:#24292F;">    container.innerHTML </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&#39;&#39;</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">proxy</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">mount</span><span style="color:#24292F;">(container, </span><span style="color:#0550AE;">false</span><span style="color:#24292F;">, container </span><span style="color:#CF222E;">instanceof</span><span style="color:#24292F;"> </span><span style="color:#953800;">SVGElement</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (container </span><span style="color:#CF222E;">instanceof</span><span style="color:#24292F;"> </span><span style="color:#953800;">Element</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">      container.</span><span style="color:#8250DF;">removeAttribute</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&#39;v-cloak&#39;</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">      container.</span><span style="color:#8250DF;">setAttribute</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&#39;data-v-app&#39;</span><span style="color:#24292F;">, </span><span style="color:#0A3069;">&#39;&#39;</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> proxy</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"></span></code></pre></div><p>è¿›å…¥åº”ç”¨æŒ‚è½½é˜¶æ®µåï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ ¸å¿ƒçš„ç»„ä»¶æ¸²æŸ“æµç¨‹ã€‚</p><h3 id="ç»„ä»¶æ¸²æŸ“" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶æ¸²æŸ“" aria-hidden="true">#</a> ç»„ä»¶æ¸²æŸ“</h3><h4 id="åˆ›å»º-vnode" tabindex="-1"><a class="header-anchor" href="#åˆ›å»º-vnode" aria-hidden="true">#</a> åˆ›å»º vnode</h4><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#6E7781;">// packages/runtime-core/src/vnode.ts</span></span>
<span class="line"><span style="color:#CF222E;">function</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">_createVNode</span><span style="color:#24292F;">(</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">type</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">VNodeTypes</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#953800;">ClassComponent</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">typeof</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">NULL_DYNAMIC_COMPONENT</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">props</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> (</span><span style="color:#953800;">Data</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">&amp;</span><span style="color:#24292F;"> </span><span style="color:#953800;">VNodeProps</span><span style="color:#24292F;">) </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">children</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">unknown</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">patchFlag</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">number</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">0</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">dynamicProps</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">string</span><span style="color:#24292F;">[] </span><span style="color:#CF222E;">|</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">isBlockNode</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">false</span></span>
<span class="line"><span style="color:#24292F;">)</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">VNode</span><span style="color:#24292F;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (props) {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// å¤„ç† props ç›¸å…³é€»è¾‘ï¼Œæ ‡å‡†åŒ– class å’Œ style</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// å¯¹ vnode ç±»å‹ä¿¡æ¯ç¼–ç </span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// ä»¥ä¾¿åœ¨åé¢çš„ patch é˜¶æ®µï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„ç±»å‹æ‰§è¡Œç›¸åº”çš„å¤„ç†é€»è¾‘</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">shapeFlag</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">isString</span><span style="color:#24292F;">(type)</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">?</span><span style="color:#24292F;"> ShapeFlags.</span><span style="color:#0550AE;">ELEMENT</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> __FEATURE_SUSPENSE__ </span><span style="color:#CF222E;">&amp;&amp;</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">isSuspense</span><span style="color:#24292F;">(type)</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#CF222E;">?</span><span style="color:#24292F;"> ShapeFlags.</span><span style="color:#0550AE;">SUSPENSE</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">isTeleport</span><span style="color:#24292F;">(type)</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">?</span><span style="color:#24292F;"> ShapeFlags.</span><span style="color:#0550AE;">TELEPORT</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">isObject</span><span style="color:#24292F;">(type)</span></span>
<span class="line"><span style="color:#24292F;">          </span><span style="color:#CF222E;">?</span><span style="color:#24292F;"> ShapeFlags.</span><span style="color:#0550AE;">STATEFUL_COMPONENT</span></span>
<span class="line"><span style="color:#24292F;">          </span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">isFunction</span><span style="color:#24292F;">(type)</span></span>
<span class="line"><span style="color:#24292F;">            </span><span style="color:#CF222E;">?</span><span style="color:#24292F;"> ShapeFlags.</span><span style="color:#0550AE;">FUNCTIONAL_COMPONENT</span></span>
<span class="line"><span style="color:#24292F;">            </span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">vnode</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">VNode</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    type,</span></span>
<span class="line"><span style="color:#24292F;">    props,</span></span>
<span class="line"><span style="color:#24292F;">    key: props </span><span style="color:#CF222E;">&amp;&amp;</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">normalizeKey</span><span style="color:#24292F;">(props),</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">...</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// æ ‡å‡†åŒ–å­èŠ‚ç‚¹ï¼ŒæŠŠä¸åŒæ•°æ®ç±»å‹çš„ children è½¬æˆæ•°ç»„æˆ–è€…æ–‡æœ¬ç±»å‹</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#8250DF;">normalizeChildren</span><span style="color:#24292F;">(vnode, children)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">return</span><span style="color:#24292F;"> vnode</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre></div><p>å·¥å‚æ¨¡å¼åˆ›å»º vnodeï¼Œå¹¶ä¸”å¯¹ propsã€children åšæ ‡å‡†åŒ–å¤„ç†ã€å¯¹ vnode çš„ typeã€children åšä¿¡æ¯ç¼–ç ï¼Œä»¥ä¾¿åœ¨åé¢å¯ä»¥æ ¹æ®ä¸åŒçš„ç±»å‹æ‰§è¡Œç›¸åº”çš„å¤„ç†é€»è¾‘ã€‚</p><h4 id="æ¸²æŸ“-vnode-patch-vnode" tabindex="-1"><a class="header-anchor" href="#æ¸²æŸ“-vnode-patch-vnode" aria-hidden="true">#</a> æ¸²æŸ“ vnodeï¼ˆpatch vnodeï¼‰</h4><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">render</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">RootRenderFunction</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (</span><span style="color:#953800;">vnode</span><span style="color:#24292F;">, </span><span style="color:#953800;">container</span><span style="color:#24292F;">, </span><span style="color:#953800;">isSVG</span><span style="color:#24292F;">) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (vnode </span><span style="color:#CF222E;">==</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// é”€æ¯ç»„ä»¶</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (container._vnode) {</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#8250DF;">unmount</span><span style="color:#24292F;">(container._vnode, </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">true</span><span style="color:#24292F;">);</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"><span style="color:#24292F;">  } </span><span style="color:#CF222E;">else</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// åˆ›å»ºæˆ–è€…æ›´æ–°ç»„ä»¶</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">patch</span><span style="color:#24292F;">(container._vnode </span><span style="color:#CF222E;">||</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">, vnode, container, </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">, isSVG);</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// ç¼“å­˜ vnode èŠ‚ç‚¹ï¼Œè¡¨ç¤ºå·²ç»æ¸²æŸ“</span></span>
<span class="line"><span style="color:#24292F;">  container._vnode </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> vnode;</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span></code></pre></div><p>patch ä¼šæ ¹æ®ä¸åŒçš„ vnode ç±»å‹æ´¾å‘ä»»åŠ¡ç»™ process å¤„ç†ã€‚ä½†åˆå§‹æ¸²æŸ“æ—¶æ—§ vnode ä¸º nullï¼Œæœ€ç»ˆå¤„ç†ç»“æœåŸºæœ¬æ˜¯ mount æ“ä½œ:</p><p><code>diff type =&gt; process =&gt; mount</code></p><p>æ¯”å¦‚æ ¹ vnode æ˜¯ä¸ªç»„ä»¶ç±»å‹ï¼Œæ•… processComponent è¿›è¡Œå¤„ç†ï¼Œè°ƒç”¨ mountComponent æ–¹æ³•æ¸²æŸ“ç»„ä»¶ã€‚</p><div class="language-typescript ext-ts"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">patch</span><span style="color:#CF222E;">:</span><span style="color:#24292F;"> </span><span style="color:#953800;">PatchFn</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">n1</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">n2</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">container</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    anchor </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    parentComponent </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    parentSuspense </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    isSVG </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">false</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    slotScopeIds </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">    optimized </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">false</span></span>
<span class="line"><span style="color:#24292F;">  ) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// å¦‚æœå­˜åœ¨æ–°æ—§èŠ‚ç‚¹, ä¸”æ–°æ—§èŠ‚ç‚¹ç±»å‹ä¸åŒï¼Œåˆ™é”€æ¯æ—§èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (n1 </span><span style="color:#CF222E;">&amp;&amp;</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">!</span><span style="color:#8250DF;">isSameVNodeType</span><span style="color:#24292F;">(n1, n2)) {</span></span>
<span class="line"><span style="color:#24292F;">      anchor </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">getNextHostNode</span><span style="color:#24292F;">(n1)</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#8250DF;">unmount</span><span style="color:#24292F;">(n1, parentComponent, parentSuspense, </span><span style="color:#0550AE;">true</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">      n1 </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> { </span><span style="color:#0550AE;">type</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">ref</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">shapeFlag</span><span style="color:#24292F;"> } </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> n2</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">switch</span><span style="color:#24292F;"> (type) {</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#CF222E;">case</span><span style="color:#24292F;"> Text:</span><span style="color:#CF222E;">...</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#CF222E;">case</span><span style="color:#24292F;"> Comment:</span><span style="color:#CF222E;">...</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#CF222E;">case</span><span style="color:#24292F;"> Static:</span><span style="color:#CF222E;">...</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#CF222E;">case</span><span style="color:#24292F;"> Fragment:</span><span style="color:#CF222E;">...</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#CF222E;">default</span><span style="color:#24292F;">:</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (shapeFlag </span><span style="color:#CF222E;">&amp;</span><span style="color:#24292F;"> ShapeFlags.</span><span style="color:#0550AE;">ELEMENT</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">         </span><span style="color:#CF222E;">...</span></span>
<span class="line"><span style="color:#24292F;">        } </span><span style="color:#CF222E;">else</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (shapeFlag </span><span style="color:#CF222E;">&amp;</span><span style="color:#24292F;"> ShapeFlags.</span><span style="color:#0550AE;">COMPONENT</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">          </span><span style="color:#8250DF;">processComponent</span><span style="color:#24292F;">(</span></span>
<span class="line"><span style="color:#24292F;">            n1,</span></span>
<span class="line"><span style="color:#24292F;">            n2,</span></span>
<span class="line"><span style="color:#24292F;">            container,</span></span>
<span class="line"><span style="color:#24292F;">            anchor,</span></span>
<span class="line"><span style="color:#24292F;">            parentComponent,</span></span>
<span class="line"><span style="color:#24292F;">            parentSuspense,</span></span>
<span class="line"><span style="color:#24292F;">            isSVG,</span></span>
<span class="line"><span style="color:#24292F;">            slotScopeIds,</span></span>
<span class="line"><span style="color:#24292F;">            optimized</span></span>
<span class="line"><span style="color:#24292F;">          )</span></span>
<span class="line"><span style="color:#24292F;">        } </span><span style="color:#CF222E;">else</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (shapeFlag </span><span style="color:#CF222E;">&amp;</span><span style="color:#24292F;"> ShapeFlags.</span><span style="color:#0550AE;">TELEPORT</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">          </span><span style="color:#CF222E;">...</span></span>
<span class="line"><span style="color:#24292F;">        } </span><span style="color:#CF222E;">else</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (__FEATURE_SUSPENSE__ </span><span style="color:#CF222E;">&amp;&amp;</span><span style="color:#24292F;"> shapeFlag </span><span style="color:#CF222E;">&amp;</span><span style="color:#24292F;"> ShapeFlags.</span><span style="color:#0550AE;">SUSPENSE</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">         </span><span style="color:#CF222E;">...</span></span>
<span class="line"><span style="color:#24292F;">        } </span><span style="color:#CF222E;">else</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (__DEV__) {</span></span>
<span class="line"><span style="color:#24292F;">          </span><span style="color:#CF222E;">...</span></span>
<span class="line"><span style="color:#24292F;">        }</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;"> </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">processComponent</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (</span><span style="color:#953800;">n1</span><span style="color:#24292F;">, </span><span style="color:#953800;">n2</span><span style="color:#24292F;">, </span><span style="color:#953800;">container</span><span style="color:#24292F;">, </span><span style="color:#953800;">anchor</span><span style="color:#24292F;">, </span><span style="color:#953800;">parentComponent</span><span style="color:#24292F;">, </span><span style="color:#953800;">parentSuspense</span><span style="color:#24292F;">, </span><span style="color:#953800;">isSVG</span><span style="color:#24292F;">, </span><span style="color:#953800;">optimized</span><span style="color:#24292F;">) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (n1 </span><span style="color:#CF222E;">==</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">   </span><span style="color:#6E7781;">// æŒ‚è½½ç»„ä»¶</span></span>
<span class="line"><span style="color:#24292F;">   </span><span style="color:#8250DF;">mountComponent</span><span style="color:#24292F;">(n2, container, anchor, parentComponent, parentSuspense, isSVG, optimized)</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">else</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// æ›´æ–°ç»„ä»¶</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">updateComponent</span><span style="color:#24292F;">(n1, n2, parentComponent, optimized)</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6E7781;">// æŒ‚è½½ç»„ä»¶</span></span>
<span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">mountComponent</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (</span><span style="color:#953800;">initialVNode</span><span style="color:#24292F;">, </span><span style="color:#953800;">container</span><span style="color:#24292F;">, </span><span style="color:#953800;">anchor</span><span style="color:#24292F;">, </span><span style="color:#953800;">parentComponent</span><span style="color:#24292F;">, </span><span style="color:#953800;">parentSuspense</span><span style="color:#24292F;">, </span><span style="color:#953800;">isSVG</span><span style="color:#24292F;">, </span><span style="color:#953800;">optimized</span><span style="color:#24292F;">) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// åˆ›å»ºç»„ä»¶å®ä¾‹</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">instance</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (initialVNode.component </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">createComponentInstance</span><span style="color:#24292F;">(initialVNode, parentComponent, parentSuspense))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// åˆå§‹åŒ– Propsã€Slotsã€è°ƒç”¨ setup åˆå§‹çŠ¶æ€</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#8250DF;">setupComponent</span><span style="color:#24292F;">(instance)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// è®¾ç½®å¹¶è¿è¡Œæ¸²æŸ“å‰¯ä½œç”¨</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#8250DF;">setupRenderEffect</span><span style="color:#24292F;">(instance, initialVNode, container, anchor, parentSuspense, isSVG, optimized)</span></span>
<span class="line"><span style="color:#24292F;">}</span></span>
<span class="line"></span></code></pre></div><p><code>mountComponent</code> æ–¹æ³•æ¸²æŸ“ç»„ä»¶ä¸­æœ€ä¸»è¦çš„æ˜¯ <code>setupRenderEffect</code>ï¼Œ<strong>è¯¥å‡½æ•°åˆ©ç”¨å“åº”å¼åº“çš„ effect å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“å‰¯ä½œç”¨ã€‚åœ¨å“åº”å¼ç³»ç»Ÿä¸‹ï¼Œå½“ç»„ä»¶çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œeffect å‡½æ•°åŒ…è£¹çš„ç»„ä»¶æ¸²æŸ“å‡½æ•°ä¼šé‡æ–°æ‰§è¡Œä¸€éï¼Œä»è€Œè¾¾åˆ°é‡æ–°æ¸²æŸ“ç»„ä»¶çš„ç›®çš„</strong>ã€‚</p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">setupRenderEffect</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">instance</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">initialVNode</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">container</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">anchor</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">parentSuspense</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">isSVG</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">optimized</span></span>
<span class="line"><span style="color:#24292F;">) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// åˆ›å»ºå“åº”å¼çš„å‰¯ä½œç”¨æ¸²æŸ“å‡½æ•°</span></span>
<span class="line"><span style="color:#24292F;">  instance.update </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">effect</span><span style="color:#24292F;">(</span><span style="color:#CF222E;">function</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">componentEffect</span><span style="color:#24292F;">() {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (</span><span style="color:#CF222E;">!</span><span style="color:#24292F;">instance.isMounted) {</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#6E7781;">// è°ƒç”¨ç»„ä»¶çš„ render æ–¹æ³•ï¼Œç”Ÿæˆ subTree</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">subTree</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (instance.subTree </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">renderComponentRoot</span><span style="color:#24292F;">(instance));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#6E7781;">// patch subTree</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#8250DF;">patch</span><span style="color:#24292F;">(</span><span style="color:#0550AE;">null</span><span style="color:#24292F;">, subTree, container, anchor, instance, parentSuspense, isSVG);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#6E7781;">// ä¿ç•™æ¸²æŸ“ç”Ÿæˆçš„å­æ ‘æ ¹ DOM èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#24292F;">      initialVNode.el </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> subTree.el;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">      instance.isMounted </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">true</span><span style="color:#24292F;">;</span></span>
<span class="line"><span style="color:#24292F;">    } </span><span style="color:#CF222E;">else</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#6E7781;">// æ›´æ–°ç»„ä»¶</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"><span style="color:#24292F;">  }, prodEffectOptions);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// åˆå§‹æ¸²æŸ“</span></span>
<span class="line"><span style="color:#24292F;">  instance.</span><span style="color:#8250DF;">update</span><span style="color:#24292F;">();</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span></code></pre></div><p><strong>ç»„ä»¶åœ¨ vnode tree ä¸­åªæ˜¯ä¸ªæŠ½è±¡èŠ‚ç‚¹ï¼Œå®é™…æ¸²æŸ“çš„æ˜¯ç»„ä»¶çš„ render å‡½æ•°ç”Ÿæˆ subTreeï¼Œæ•…è¿˜è¦ç»§ç»­ patch subTree</strong>ã€‚</p><p>ç»è¿‡ patch å‡½æ•°çš„æ·±åº¦é€’å½’å¤„ç†ï¼Œ<strong>æ™®é€šå…ƒç´ ç±»å‹çš„èŠ‚ç‚¹</strong>å¤„ç†æ‰ä¼šæ˜¯æœ€ç»ˆååº”åˆ°é¡µé¢ä¸Šã€‚</p><div class="language-javascript ext-js"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#6E7781;">// patch =&gt; processElement =&gt; mountElement</span></span>
<span class="line"><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">mountElement</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> (</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">vnode</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">container</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">anchor</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">parentComponent</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">parentSuspense</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">isSVG</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#953800;">optimized</span></span>
<span class="line"><span style="color:#24292F;">) </span><span style="color:#CF222E;">=&gt;</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">let</span><span style="color:#24292F;"> el;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> { </span><span style="color:#0550AE;">type</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">props</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">shapeFlag</span><span style="color:#24292F;"> } </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> vnode;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// åˆ›å»º DOM å…ƒç´ èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#24292F;">  el </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> vnode.el </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">hostCreateElement</span><span style="color:#24292F;">(vnode.type, isSVG, props </span><span style="color:#CF222E;">&amp;&amp;</span><span style="color:#24292F;"> props.is);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (props) {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// å¤„ç† propsï¼Œæ¯”å¦‚ classã€styleã€event ç­‰å±æ€§</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">for</span><span style="color:#24292F;"> (</span><span style="color:#CF222E;">const</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">key</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">in</span><span style="color:#24292F;"> props) {</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (</span><span style="color:#CF222E;">!</span><span style="color:#8250DF;">isReservedProp</span><span style="color:#24292F;">(key)) {</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#8250DF;">hostPatchProp</span><span style="color:#24292F;">(el, key, </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">, props[key], isSVG);</span></span>
<span class="line"><span style="color:#24292F;">      }</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (shapeFlag </span><span style="color:#CF222E;">&amp;</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">8</span><span style="color:#24292F;"> </span><span style="color:#6E7781;">/* TEXT_CHILDREN */</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// å¤„ç†å­èŠ‚ç‚¹æ˜¯çº¯æ–‡æœ¬çš„æƒ…å†µ</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">hostSetElementText</span><span style="color:#24292F;">(el, vnode.children);</span></span>
<span class="line"><span style="color:#24292F;">  } </span><span style="color:#CF222E;">else</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (shapeFlag </span><span style="color:#CF222E;">&amp;</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">16</span><span style="color:#24292F;"> </span><span style="color:#6E7781;">/* ARRAY_CHILDREN */</span><span style="color:#24292F;">) {</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#6E7781;">// å¤„ç†å­èŠ‚ç‚¹æ˜¯æ•°ç»„çš„æƒ…å†µ</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">mountChildren</span><span style="color:#24292F;">(</span></span>
<span class="line"><span style="color:#24292F;">      vnode.children,</span></span>
<span class="line"><span style="color:#24292F;">      el,</span></span>
<span class="line"><span style="color:#24292F;">      </span><span style="color:#0550AE;">null</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">      parentComponent,</span></span>
<span class="line"><span style="color:#24292F;">      parentSuspense,</span></span>
<span class="line"><span style="color:#24292F;">      isSVG </span><span style="color:#CF222E;">&amp;&amp;</span><span style="color:#24292F;"> type </span><span style="color:#CF222E;">!==</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;foreignObject&quot;</span><span style="color:#24292F;">,</span></span>
<span class="line"><span style="color:#24292F;">      optimized </span><span style="color:#CF222E;">||</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">!!</span><span style="color:#24292F;">vnode.dynamicChildren</span></span>
<span class="line"><span style="color:#24292F;">    );</span></span>
<span class="line"><span style="color:#24292F;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#6E7781;">// æŠŠåˆ›å»ºçš„ DOM å…ƒç´ èŠ‚ç‚¹æŒ‚è½½åˆ° container ä¸Š</span></span>
<span class="line"><span style="color:#24292F;">  </span><span style="color:#8250DF;">hostInsert</span><span style="color:#24292F;">(el, container, anchor);</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span></code></pre></div><p><strong>åœ¨ mountElement æ–¹æ³•è°ƒç”¨å¹³å°æ¸²æŸ“æ–¹æ³•ï¼Œæ¯”å¦‚ <code>hostCreateElement</code>ï¼Œåœ¨ web å¹³å°åº•å±‚å°±æ˜¯è°ƒç”¨ <code>document.createElement</code> æ–¹æ³•</strong>ã€‚</p><p>æ·±åº¦é€’å½’ vnode tree çš„è¿‡ç¨‹ï¼Œ<strong>æŒ‚è½½çš„é¡ºåºæ˜¯å…ˆå­èŠ‚ç‚¹ï¼Œåçˆ¶èŠ‚ç‚¹ï¼Œæœ€ç»ˆæŒ‚è½½åˆ°æœ€å¤–å±‚çš„å®¹å™¨ä¸Š</strong>ï¼Œå®Œæˆæ•´ä¸ªæ¸²æŸ“æµç¨‹ã€‚</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><ol><li>åˆ›å»ºåº”ç”¨ createAppï¼Œå¯ä»¥è®©æˆ‘ä»¬è¿›è¡Œåº”ç”¨ç¯å¢ƒéš”ç¦»</li><li>ç»„ä»¶ vnode æ˜¯æŠ½è±¡èŠ‚ç‚¹ï¼Œæ˜¯ä¸ä¼šç”ŸæˆçœŸå®èŠ‚ç‚¹ï¼Œè°ƒç”¨ç»„ä»¶æ¨¡æ¿ç”Ÿæˆ subTree å»æ¸²æŸ“</li><li>å…ƒç´ ç±»å‹çš„èŠ‚ç‚¹æ‰ä¼šæœ€ç»ˆè½å®æ¸²æŸ“æˆçœŸå® DOM èŠ‚ç‚¹</li><li>VirtualDOM çš„æ¸²æŸ“æœºåˆ¶å°±æ˜¯æ·±åº¦é€’å½’ diff æ–°æ—§ vnode tree å·®å¼‚å¹¶è°ƒç”¨å¹³å°çš„æ¸²æŸ“æ¥å£ï¼Œç”ŸæˆçœŸå®çš„ DOM</li></ol><blockquote><p>ä¸‹å›¾ä¸º vue æ¸²æŸ“æµç¨‹ï¼Œå…¶ä¸­æ›´æ–°æµç¨‹ä¹ŸåŒ…æ‹¬åœ¨é‡Œé¢</p></blockquote><p><img src="/assets/img/089ea60df2fe1490c5fb0c69e460a9681c509346e0486d52a95d131902cbbc92.7d6fc3a3.png" alt="å›¾ 6"></p><p>ä¸‹ç¯‡ <a href="/Vue/diff%20%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B.html" class="">diff æ›´æ–°æµç¨‹</a>ã€‚</p></div><!----></article></div><footer class="footer footer-center p-4 bg-base-300 text-base-content opacity-60"><div><p>Â©2017-2021 laoergege.cn. All right reserved. </p><p><a href="https://beian.miit.gov.cn" target="_blank" class="link link-hover">ç²¤ICPå¤‡2022020679å·</a></p></div></footer><!--]--><!----><!--]--></div>
    <script src="/assets/js/runtime~app.7d4bd660.js" defer></script><script src="/assets/js/5838.13a569e5.js" defer></script><script src="/assets/js/app.7e792774.js" defer></script>
</body>

</html>