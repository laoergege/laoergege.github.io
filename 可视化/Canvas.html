<!DOCTYPE html>
<html lang="zh-CN" data-theme="cupcake">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.46">
    <link rel="manifest" href="/site.webmanifest.json"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><title>Canvas | </title><meta name="description" content="Just For Fun">
    <link rel="preload" href="/assets/js/runtime~app.7d4bd660.js" as="script"><link rel="preload" href="/assets/css/styles.1c65b737.css" as="style"><link rel="preload" href="/assets/js/5838.13a569e5.js" as="script"><link rel="preload" href="/assets/js/app.7e792774.js" as="script"><link rel="prefetch" href="/assets/js/v-03fc2322.47d94022.js"><link rel="prefetch" href="/assets/js/v-ba2c1988.3632b5e0.js"><link rel="prefetch" href="/assets/js/v-fd8e5af2.a9cafb88.js"><link rel="prefetch" href="/assets/js/v-5a071f34.190f1fdc.js"><link rel="prefetch" href="/assets/js/v-317472f1.a3c9dba2.js"><link rel="prefetch" href="/assets/js/v-560b844b.09f8a065.js"><link rel="prefetch" href="/assets/js/v-85bc3e4c.27575d9e.js"><link rel="prefetch" href="/assets/js/v-4835f72d.209f9a9b.js"><link rel="prefetch" href="/assets/js/v-6f2abf9c.c6a52b82.js"><link rel="prefetch" href="/assets/js/v-32c68258.46247de2.js"><link rel="prefetch" href="/assets/js/v-04983e79.ae40370a.js"><link rel="prefetch" href="/assets/js/v-7269d92e.00653b56.js"><link rel="prefetch" href="/assets/js/v-54e51afe.e3f20358.js"><link rel="prefetch" href="/assets/js/v-5fbdabee.afcc17b5.js"><link rel="prefetch" href="/assets/js/v-928f5a14.0a4a3dc4.js"><link rel="prefetch" href="/assets/js/v-88c7f226.529f6212.js"><link rel="prefetch" href="/assets/js/v-5e99732b.68dd2407.js"><link rel="prefetch" href="/assets/js/v-2fc78b4d.97b37f50.js"><link rel="prefetch" href="/assets/js/v-d99bba28.2cf82742.js"><link rel="prefetch" href="/assets/js/v-bee2f4a8.f072eb83.js"><link rel="prefetch" href="/assets/js/v-57ad8616.44af159f.js"><link rel="prefetch" href="/assets/js/v-f701b528.aa7f8f17.js"><link rel="prefetch" href="/assets/js/v-093d016d.bc725dd1.js"><link rel="prefetch" href="/assets/js/v-06ed95cc.0db5595a.js"><link rel="prefetch" href="/assets/js/v-01b20944.db789013.js"><link rel="prefetch" href="/assets/js/v-137d7552.50039c10.js"><link rel="prefetch" href="/assets/css/5045.styles.72ac531f.css"><link rel="prefetch" href="/assets/js/v-631fc68a.80740d81.js"><link rel="prefetch" href="/assets/js/v-8b5f7690.191ba9a3.js"><link rel="prefetch" href="/assets/js/v-530f22f6.f8e361fa.js"><link rel="prefetch" href="/assets/js/v-be2646cc.549f65bf.js"><link rel="prefetch" href="/assets/js/v-75e44f07.2f8601c3.js"><link rel="prefetch" href="/assets/js/v-c2504efe.28c55f92.js"><link rel="prefetch" href="/assets/js/v-5bc51cd9.b23c2caa.js"><link rel="prefetch" href="/assets/js/5956.f176ea33.js"><link rel="prefetch" href="/assets/js/v-6dc8e518.a8181c32.js"><link rel="prefetch" href="/assets/js/v-568d3b89.483d19f1.js"><link rel="prefetch" href="/assets/js/v-743faa02.3247db36.js"><link rel="prefetch" href="/assets/js/v-d52c6cc0.34d4b256.js"><link rel="prefetch" href="/assets/js/v-78263bfa.b7cb21e4.js"><link rel="prefetch" href="/assets/js/v-199de1f8.16ad6f91.js"><link rel="prefetch" href="/assets/js/v-30078430.3079f1d2.js"><link rel="prefetch" href="/assets/js/v-240dbb06.02e786fb.js"><link rel="prefetch" href="/assets/js/v-7a102f72.94a1b7e7.js"><link rel="prefetch" href="/assets/js/v-1402111c.9dc8cc11.js"><link rel="prefetch" href="/assets/js/v-f2bbc8da.fc4d9aa5.js"><link rel="prefetch" href="/assets/js/v-b0176dc2.b994ff0c.js"><link rel="prefetch" href="/assets/js/4644.1787b6ff.js"><link rel="prefetch" href="/assets/js/v-a5da5a08.cc633de8.js"><link rel="prefetch" href="/assets/js/v-acadbc84.800a32fa.js"><link rel="prefetch" href="/assets/js/v-a270a8ca.ea9c331c.js"><link rel="prefetch" href="/assets/js/v-a9440b46.63ee3544.js"><link rel="prefetch" href="/assets/js/6929.46233b49.js"><link rel="prefetch" href="/assets/js/9840.789f773b.js"><link rel="prefetch" href="/assets/js/v-9f06f78c.ff18832e.js"><link rel="prefetch" href="/assets/js/9870.c84a31ac.js"><link rel="prefetch" href="/assets/js/v-8daa1a0e.8245b191.js"><link rel="prefetch" href="/sw.js"><link rel="prefetch" href="/assets/css/3859.styles.7057c730.css">
    <link rel="stylesheet" href="/assets/css/styles.1c65b737.css">
</head>

<body>
    <div id="app"><!--[--><!--[--><div class="navbar sticky top-0 z-10"><a href="/" class=""><label class="btn btn-circle avatar"><div class="rounded-full ring ring-white shadow-2xl no-zoom"><img src="/avatar.webp"></div></label></a></div><div class="min-h-screen flex justify-center flex-col items-center"><article class="article w-full sm:w-3/4 lg:w-2/3 p-4" data-theme="cupcake"><div class="sm:max-w-full pb-12 prose sm:prose-sm md:prose-lg dark:prose-invert"><h1 id="canvas" tabindex="-1"><a class="header-anchor" href="#canvas" aria-hidden="true">#</a> Canvas</h1><p>Canvas API 提供了一个通过JavaScript 和 HTML的 <code>&lt;canvas&gt;</code> 元素来绘制图形的方式，相比较浏览器 HTML 的声明式渲染页面方式，Canvas 更像似更接近底层，在系统图形绘制指令上封装的一套绘制指令系统。</p><p>Canvas API 支持</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D" target="_blank" rel="noopener noreferrer">CanvasRenderingContext2D<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 接口的2D渲染</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL2RenderingContext" target="_blank" rel="noopener noreferrer">WebGL2RenderingContext<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 接口的硬件加速的 2D、3D 渲染</li></ul><blockquote><p>本文主要以 CanvasRenderingContext2D 渲染为主</p></blockquote><ul><li>canvas <ul><li>基础 <ul><li>画布及坐标系 <ul><li>画布跟坐标系初始重叠</li></ul></li><li>绘制指令 <ul><li>状态 <ul><li>save 和 restore</li><li>色彩</li><li>透明</li><li>线条</li></ul></li><li>图形 <ul><li><a href="#%E8%B7%AF%E5%BE%84">路径</a></li><li>文本</li><li>图像</li></ul></li><li>坐标系变换 <ul><li>没有 transform-origin</li></ul></li></ul></li><li>二次贝塞尔曲线及三次贝塞尔曲线</li></ul></li><li>进阶 <ul><li>事件交互 <ul><li>凸包算法</li><li>isPointInPath + 包围盒</li></ul></li><li>动画</li><li>优化 <ul><li>Path2D 缓存或记录绘画指令</li></ul></li></ul></li><li>常见问题 <ul><li>Canvas 高清适配</li><li>Canvas 跨域</li></ul></li></ul></li></ul><h2 id="画布及坐标系" tabindex="-1"><a class="header-anchor" href="#画布及坐标系" aria-hidden="true">#</a> 画布及坐标系</h2><div class="language-html ext-html"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292F;">&lt;</span><span style="color:#116329;">script</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">type</span><span style="color:#24292F;">=</span><span style="color:#0A3069;">&quot;text/javascript&quot;</span><span style="color:#24292F;">&gt;</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">function</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">draw</span><span style="color:#24292F;">() {</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> canvas </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> document.</span><span style="color:#8250DF;">getElementById</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&#39;tutorial&#39;</span><span style="color:#24292F;">);</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (canvas.getContext) {</span></span>
<span class="line"><span style="color:#24292F;">            </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> ctx </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> canvas.</span><span style="color:#8250DF;">getContext</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&#39;2d&#39;</span><span style="color:#24292F;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">            ctx.fillColor </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&#39;yellow&#39;</span></span>
<span class="line"><span style="color:#24292F;">            ctx.</span><span style="color:#8250DF;">fillRect</span><span style="color:#24292F;">(</span><span style="color:#0550AE;">0</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">0</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">150</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">150</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#24292F;">        }</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"><span style="color:#24292F;">&lt;/</span><span style="color:#116329;">script</span><span style="color:#24292F;">&gt;</span></span>
<span class="line"><span style="color:#24292F;">&lt;</span><span style="color:#116329;">style</span><span style="color:#24292F;">&gt;</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#116329;">canvas</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#0550AE;">width</span><span style="color:#24292F;">: </span><span style="color:#0550AE;">300</span><span style="color:#CF222E;">px</span><span style="color:#24292F;">;</span></span>
<span class="line"><span style="color:#24292F;">        </span><span style="color:#0550AE;">height</span><span style="color:#24292F;">: </span><span style="color:#0550AE;">300</span><span style="color:#CF222E;">px</span><span style="color:#24292F;">;</span></span>
<span class="line"><span style="color:#24292F;">    }</span></span>
<span class="line"><span style="color:#24292F;">&lt;/</span><span style="color:#116329;">style</span><span style="color:#24292F;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">&lt;</span><span style="color:#116329;">body</span><span style="color:#24292F;">&gt;</span></span>
<span class="line"><span style="color:#24292F;">    &lt;</span><span style="color:#116329;">canvas</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">id</span><span style="color:#24292F;">=</span><span style="color:#0A3069;">&quot;tutorial&quot;</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">width</span><span style="color:#24292F;">=</span><span style="color:#0A3069;">&quot;150&quot;</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">height</span><span style="color:#24292F;">=</span><span style="color:#0A3069;">&quot;150&quot;</span><span style="color:#24292F;">&gt;请升级最新浏览器&lt;</span><span style="color:#116329;">canvas</span><span style="color:#24292F;">&gt;</span></span>
<span class="line"><span style="color:#24292F;">&lt;/</span><span style="color:#116329;">body</span><span style="color:#24292F;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>Canvas <strong>元素及画布</strong>的默认大小为一致，且为 300像素×150像素（宽×高，像素的单位是px），可通过 css 样式去改变 canvas 元素在页面布局的大小，画布内容会自适应元素大小</p><p><img src="/assets/img/iShot2020-07-08pm11.20.08.45438b27.png" alt=""></p><p>上面案例中，我们画布大小为 150 <em>150，元素大小 300</em> 300，最后图像自适应填充了整个元素大小</p><blockquote><p>注意：如果CSS的尺寸与初始画布的比例不一致，它会出现扭曲</p></blockquote><h3 id="坐标系" tabindex="-1"><a class="header-anchor" href="#坐标系" aria-hidden="true">#</a> 坐标系</h3><p>在画布中所有元素的位置都是在按照以左上角位置为原点（0，0），y 轴向下的坐标系中</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANwAAADcCAMAAAAshD+zAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAABgUExURQAAACYmJn5+fry8vOrq6kNDQ9zc3I6Ojm5ubp2dna2trVtbW87OzsjIyO/v7////zJfofb29v7+/uXl5ff39/39/fj4+Pz8/Pn5+fr6+szMzPv7+6enp+fn59DQ0PT09O486JcAAAQQSURBVHja7N2JjtowEAZgXzPkIi5H2wANvP9b1uFYtZtAE661p/8v8GqjCPxp7JhYK1Z5wVHAAQcccMABB5wAXON4v004e3bNNdyB2R0WCefgmA/DuIbbRfJpuRnEOV4ICLtBHDsJOMeDuP1BAu6wH8RtFyKyBS5ceoiolYqj+WJOQnFtB0uudCNx1oTGWKG4LDSZUNxCn58icXlpy1zsOmeTm3EjcOkscG0YWXY+CZfQAkfz9u86XMGtL2kpNNSuUwiTyf868C+cNaExNjQqWpS6dM3QehouC01mu1eIOsfOlnoabq3Pz/XQ5tjq9jE18rz7j/36s3KWZmYa7rjAxY27hHit20m4MOvs+j5cGC3vxBXmPIsm4D6mbey4fl6Je/ewBA444IADDjjggAMOOOCAux+36qe6fUyNPO/+Y6gccCPfmCvvaxsx7kc/43Gq9qZ8E+7HrbwA50vjNUvFsZqRl4rzpbJycTl5uThdyMVZ7eXiTCEY985PKMABBxxwwAH3JFyUeyio3L24uqi9raTOubKsdGK4pp8ruFqr/AuHZXMrD+P8TNdicYUqtVRcpaow7YY7844/j3pt5erjQyjui9e5J+KUGv3G3akJ4abn2/2Jv3Jp4SYOI+CAAw444IThpu95PIAbu4fyP1RuLheXG21CeCRu00+cuGPXLrjPXRaBuxbg4seZ7g7LCsVpJ7hyJHVYZkSkdWi2AnFbe47D1RK4qHCn3bbPs04ILrObLW0siV0KjN3IxGneOGKnReIKTcrkqpB5tXSWN+ywFAziotxDOY5JszFTblZ3/cRZua5nhdmdcJ+7LAF3NcDFj2NSnEnFkaUdSZ1zgbYzVm7lWDuhuC0pXeBqCVxcuIK63S+hOF10u19ilwKhwzIPn5l1KfSDc27OwV2BdNzPfuLE/bwV4E64KPdQUDnggAMOOOCAA24i7vXHgAMOOOCAexnuez9x4r7fCnD/Ae5V32ny0PehoHLAAQcccMABBxxwwAEHHHDAicAt+4kTt7wV4E64KPdQUDnggAMOOOCA+zfuV4x5Fm6ZXIADbmKsPf00MeCUepLugjKvHxBvx1Wq+sDlHAnu2b3ocGRF4Gx2nF35LIjCrzMqMxOKqMPLGjJfj3ssimtVLPWpVDnVrC+Vs7XmxHGmnGnK6TQCOtQfw5Js4rha6Up3hes0Zb5cZvHgwlxZcvFQ6ah7nHBWF7mKCNd1pXqodMWyzi+rNpu8W8S7peC8IrwT17vJoNpmPrWMxdny03+okYTzZe7l4owFDrjocCkGOOCAiwG330mw7faDOK4l4GoexLmVBNzKDeIadunbHDeDOH/gVZ30vNvVKz74YZxvHO+3CWfPrvHXcNICHHDAAQcccMAlmt8CDABIbErQtEaWvQAAAABJRU5ErkJggg==" alt="Canvas_default_grid"></p><h2 id="路径" tabindex="-1"><a class="header-anchor" href="#路径" aria-hidden="true">#</a> 路径</h2><p>Canvas 只提供矩形绘制的 API（fillRect、strokeRect），其他复杂的图形需要我们自己绘制路径形成。</p><p><strong>路径是有一条或多条直线、曲线形成；而图形都是通过一条或者多条路径闭合形成的</strong></p><p>创建图形的步骤如下：</p><h3 id="描绘路径" tabindex="-1"><a class="header-anchor" href="#描绘路径" aria-hidden="true">#</a> 描绘路径</h3><p>CanvasRenderingContext2D 提供了一些<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D#%E8%B7%AF%E5%BE%84" target="_blank" rel="noopener noreferrer">描绘路径方法列表<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，其中：</p><ul><li><p>beginPath 声明开始创建路径</p><p>路径是由很多子路径构成，这些子路径都是在一个<strong>列表</strong>中，所有的子路径（线、弧形、等等）构成图形。而每次这个方法调用之后，列表清空重置，然后我们就可以重新绘制新的图形。</p></li><li><p>moveTo 确定路径起点</p></li><li><p>lineTo 直线连接坐标</p></li><li><p>closePath 闭合路径</p><p>closePath 会通过绘制一条从当前点到开始点的直线来闭合图形。以 fill 填充方式绘制路径，会自动闭合。</p></li></ul><p>还有其他生成路径的，如线型 lineTo、贝赛尔曲线型 bezierCurveTo、圆型 arcTo 等，请参考<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D#%E8%B7%AF%E5%BE%84" target="_blank" rel="noopener noreferrer">文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><h3 id="绘制路径" tabindex="-1"><a class="header-anchor" href="#绘制路径" aria-hidden="true">#</a> 绘制路径</h3><p>描绘完路径后，就需要把路径绘制到屏幕上，主要有两种方式 stroke 描边和 fill 填充的方式将路径绘制到画布中。</p><h2 id="绘制图像" tabindex="-1"><a class="header-anchor" href="#绘制图像" aria-hidden="true">#</a> 绘制图像</h2><h3 id="裁剪、合成" tabindex="-1"><a class="header-anchor" href="#裁剪、合成" aria-hidden="true">#</a> 裁剪、合成</h3><h2 id="动画" tabindex="-1"><a class="header-anchor" href="#动画" aria-hidden="true">#</a> 动画</h2><h2 id="canvas-高清适配" tabindex="-1"><a class="header-anchor" href="#canvas-高清适配" aria-hidden="true">#</a> Canvas 高清适配</h2></div><!----></article></div><footer class="footer footer-center p-4 bg-base-300 text-base-content opacity-60"><div><p>©2017-2021 laoergege.cn. All right reserved. </p><p><a href="https://beian.miit.gov.cn" target="_blank" class="link link-hover">粤ICP备2022020679号</a></p></div></footer><!--]--><!----><!--]--></div>
    <script src="/assets/js/runtime~app.7d4bd660.js" defer></script><script src="/assets/js/5838.13a569e5.js" defer></script><script src="/assets/js/app.7e792774.js" defer></script>
</body>

</html>