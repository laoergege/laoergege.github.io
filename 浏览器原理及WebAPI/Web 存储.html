<!DOCTYPE html>
<html lang="zh-CN" data-theme="cupcake">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.46">
    <link rel="manifest" href="/site.webmanifest.json"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><title>Web 存储 | </title><meta name="description" content="Just For Fun">
    <link rel="preload" href="/assets/js/runtime~app.7d4bd660.js" as="script"><link rel="preload" href="/assets/css/styles.1c65b737.css" as="style"><link rel="preload" href="/assets/js/5838.13a569e5.js" as="script"><link rel="preload" href="/assets/js/app.7e792774.js" as="script"><link rel="prefetch" href="/assets/js/v-03fc2322.47d94022.js"><link rel="prefetch" href="/assets/js/v-ba2c1988.3632b5e0.js"><link rel="prefetch" href="/assets/js/v-fd8e5af2.a9cafb88.js"><link rel="prefetch" href="/assets/js/v-5a071f34.190f1fdc.js"><link rel="prefetch" href="/assets/js/v-317472f1.a3c9dba2.js"><link rel="prefetch" href="/assets/js/v-560b844b.09f8a065.js"><link rel="prefetch" href="/assets/js/v-85bc3e4c.27575d9e.js"><link rel="prefetch" href="/assets/js/v-4835f72d.209f9a9b.js"><link rel="prefetch" href="/assets/js/v-6f2abf9c.c6a52b82.js"><link rel="prefetch" href="/assets/js/v-32c68258.46247de2.js"><link rel="prefetch" href="/assets/js/v-04983e79.ae40370a.js"><link rel="prefetch" href="/assets/js/v-7269d92e.00653b56.js"><link rel="prefetch" href="/assets/js/v-54e51afe.e3f20358.js"><link rel="prefetch" href="/assets/js/v-5fbdabee.afcc17b5.js"><link rel="prefetch" href="/assets/js/v-928f5a14.0a4a3dc4.js"><link rel="prefetch" href="/assets/js/v-88c7f226.529f6212.js"><link rel="prefetch" href="/assets/js/v-5e99732b.68dd2407.js"><link rel="prefetch" href="/assets/js/v-2fc78b4d.97b37f50.js"><link rel="prefetch" href="/assets/js/v-d99bba28.2cf82742.js"><link rel="prefetch" href="/assets/js/v-bee2f4a8.f072eb83.js"><link rel="prefetch" href="/assets/js/v-57ad8616.44af159f.js"><link rel="prefetch" href="/assets/js/v-f701b528.aa7f8f17.js"><link rel="prefetch" href="/assets/js/v-093d016d.bc725dd1.js"><link rel="prefetch" href="/assets/js/v-06ed95cc.0db5595a.js"><link rel="prefetch" href="/assets/js/v-01b20944.db789013.js"><link rel="prefetch" href="/assets/js/v-137d7552.50039c10.js"><link rel="prefetch" href="/assets/css/5045.styles.72ac531f.css"><link rel="prefetch" href="/assets/js/v-631fc68a.80740d81.js"><link rel="prefetch" href="/assets/js/v-8b5f7690.191ba9a3.js"><link rel="prefetch" href="/assets/js/v-530f22f6.f8e361fa.js"><link rel="prefetch" href="/assets/js/v-be2646cc.549f65bf.js"><link rel="prefetch" href="/assets/js/v-75e44f07.2f8601c3.js"><link rel="prefetch" href="/assets/js/v-c2504efe.28c55f92.js"><link rel="prefetch" href="/assets/js/v-5bc51cd9.b23c2caa.js"><link rel="prefetch" href="/assets/js/5956.f176ea33.js"><link rel="prefetch" href="/assets/js/v-6dc8e518.a8181c32.js"><link rel="prefetch" href="/assets/js/v-568d3b89.483d19f1.js"><link rel="prefetch" href="/assets/js/v-743faa02.3247db36.js"><link rel="prefetch" href="/assets/js/v-d52c6cc0.34d4b256.js"><link rel="prefetch" href="/assets/js/v-78263bfa.b7cb21e4.js"><link rel="prefetch" href="/assets/js/v-199de1f8.16ad6f91.js"><link rel="prefetch" href="/assets/js/v-30078430.3079f1d2.js"><link rel="prefetch" href="/assets/js/v-240dbb06.02e786fb.js"><link rel="prefetch" href="/assets/js/v-7a102f72.94a1b7e7.js"><link rel="prefetch" href="/assets/js/v-1402111c.9dc8cc11.js"><link rel="prefetch" href="/assets/js/v-f2bbc8da.fc4d9aa5.js"><link rel="prefetch" href="/assets/js/v-b0176dc2.b994ff0c.js"><link rel="prefetch" href="/assets/js/4644.1787b6ff.js"><link rel="prefetch" href="/assets/js/v-a5da5a08.cc633de8.js"><link rel="prefetch" href="/assets/js/v-acadbc84.800a32fa.js"><link rel="prefetch" href="/assets/js/v-a270a8ca.ea9c331c.js"><link rel="prefetch" href="/assets/js/v-a9440b46.63ee3544.js"><link rel="prefetch" href="/assets/js/6929.46233b49.js"><link rel="prefetch" href="/assets/js/9840.789f773b.js"><link rel="prefetch" href="/assets/js/v-9f06f78c.ff18832e.js"><link rel="prefetch" href="/assets/js/9870.c84a31ac.js"><link rel="prefetch" href="/assets/js/v-8daa1a0e.8245b191.js"><link rel="prefetch" href="/sw.js"><link rel="prefetch" href="/assets/css/3859.styles.7057c730.css">
    <link rel="stylesheet" href="/assets/css/styles.1c65b737.css">
</head>

<body>
    <div id="app"><!--[--><!--[--><div class="navbar sticky top-0 z-10"><a href="/" class=""><label class="btn btn-circle avatar"><div class="rounded-full ring ring-white shadow-2xl no-zoom"><img src="/avatar.webp"></div></label></a></div><div class="min-h-screen flex justify-center flex-col items-center"><article class="article w-full sm:w-3/4 lg:w-2/3 p-4" data-theme="cupcake"><div class="sm:max-w-full pb-12 prose sm:prose-sm md:prose-lg dark:prose-invert"><h1 id="web-存储" tabindex="-1"><a class="header-anchor" href="#web-存储" aria-hidden="true">#</a> Web 存储</h1><ul><li><a href="https://web.dev/storage-for-the-web/#%E5%A4%9A%E5%B0%91" target="_blank" rel="noopener noreferrer">客户端存储限额及检查<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>Web 存储 <ul><li>Cookie <ul><li>大小、数量：不超过 4K，每个域下最多允许有 20+ 个左右的 cookie</li><li>生命周期 <ul><li>Expires 绝对过期时间</li><li>MaxAge 相对过期时间，单位是秒，浏览器用收到报文的时间点再加上 Max-Age，就可以得到失效的绝对时间；优先级比 Expires 高；MaxAge = 0 会话结束过期</li></ul></li><li>作用范围：控制 Cookie 的可见范围，可同站共享 <ul><li>Domain <ul><li>默认为当前文档域名</li><li>但默认情况下，Cookie 只有显示设置的域下才能被子域共享访问</li><li>如果 Set-Cookie 的 Domain 跟请求源不是同站，则代理会拒绝设置</li><li>document.cookie 设置了 cookie，那么无论脚本来自何处，这个 cookie 都属于当前网页的域</li></ul></li><li>Path <ul><li>默认为当前路径</li></ul></li></ul></li><li>安全 <ul><li>HttpOnly：不允许 js 操作，以防范跨站脚本攻击（XSS）</li><li>Secure：只允许通过 HTTPS 安全协议通道发送给服务器</li><li>SameSite：防止跨站请求时被发送 Cookie，从而可以阻止跨站请求伪造攻击（CSRF） <ul><li>Strict：严格禁止在跨站请求时发送 cookie</li><li>Lax（默认）：禁止在跨站请求时发送 cookie，除非 <ul><li>HTTP 方法是“安全的”（&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;, and &quot;TRACE&quot;）</li><li>顶层导航（更改浏览器地址栏中的 URL）</li></ul></li><li>None：允许跨站请求时发送 cookie <ul><li>具有<code>SameSite=None</code> 的 cookie 还必须指定 Secure</li></ul></li></ul></li><li>SameParty</li></ul></li><li>其他 <ul><li><a href="#javascritpt-%E4%B8%AD%E7%9A%84-cookie-%E6%93%8D%E4%BD%9C">JavaScritpt 中的 cookie 操作</a><ul><li>Cookie Store API</li></ul></li><li><a href="#%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%A4%9A%E4%B8%AA%E5%90%8C%E5%90%8D-cookie">如何处理多个同名 Cookie</a></li><li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9-cookie">第三方 Cookie</a></li><li><a href="https://web.dev/samesite-cookie-recipes/#%E5%A4%84%E7%90%86%E4%B8%8D%E5%85%BC%E5%AE%B9%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF" target="_blank" rel="noopener noreferrer">部署 SameSite 及兼容处理<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></li></ul></li><li>LocalStorage、SessionStorage <ul><li>大小：限制为 5MB+，具体取决于浏览器</li><li>生命周期 <ul><li>LocalStorage：永久</li><li>SessionStorage：页面关闭即失效</li></ul></li><li>其他 <ul><li>可监听 storage 事件</li></ul></li></ul></li><li>IndexDB <ul><li>大小：一般不少于 250 MB</li><li>生命周期：永久</li><li>其他 <ul><li>能够在 Web Worker 及 Service Worker 环境下访问</li></ul></li></ul></li><li>CacheStorage、CacheAPI <ul><li>大小：一般不少于 250 MB</li><li>生命周期：永久</li><li>其他 <ul><li>能够在 Web Worker 及 Service Worker 环境下访问</li></ul></li></ul></li><li><a href="https://web.dev/bfcache/?utm_source=devtools" target="_blank" rel="noopener noreferrer">Back/forward cache<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>HTTP Cache</li></ul></li></ul><h2 id="javascritpt-中的-cookie-操作" tabindex="-1"><a class="header-anchor" href="#javascritpt-中的-cookie-操作" aria-hidden="true">#</a> JavaScritpt 中的 cookie 操作</h2><p><code>document.cookie</code> 能够获取仅对当前页面可用的 cookie，每条 cookie 以&quot;分号和空格 (; )&quot;分隔，结果如下</p><div class="language-text ext-text"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292f;">name1=value1; name2=value2</span></span>
<span class="line"><span style="color:#24292f;"></span></span></code></pre></div><p>写入 cookie 时，键值必须通过 <code>encodeURIComponent()</code> (en-US)来保证它不包含任何逗号、分号或空格 (cookie 值中禁止使用这些值)：</p><div class="language-text ext-text"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292f;">document.cookie = encodeURIComponent(&quot;name&quot;) + &#39;=&#39; + encodeURIComponent(&quot;value&quot;)</span></span>
<span class="line"><span style="color:#24292f;"></span></span></code></pre></div><h2 id="如何处理多个同名-cookie" tabindex="-1"><a class="header-anchor" href="#如何处理多个同名-cookie" aria-hidden="true">#</a> 如何处理多个同名 Cookie</h2><blockquote><p>参考 https://httpwg.org/specs/rfc6265.html#storage-model 5.3 存储模型章节第 11 小点</p></blockquote><ol><li>客户端代理将同名、同域、同路径的当作同一 Cookie</li><li>如果重复设置相同 Cookie 则会替换更新，否则存入新的 Cookie 值</li></ol><h2 id="第三方-cookie" tabindex="-1"><a class="header-anchor" href="#第三方-cookie" aria-hidden="true">#</a> 第三方 Cookie</h2><p>如果 cookie 的注册域与当前页面 URL 的 <a href="https://web.dev/same-site-same-origin/" target="_blank" rel="noopener noreferrer">eTLD+1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 相匹配，则认为 cookie 与页面来自同一站点，通常称为第一方 cookie，不同站点的则称为第三方 cookie。</p><h3 id="行为跟踪" tabindex="-1"><a class="header-anchor" href="#行为跟踪" aria-hidden="true">#</a> 行为跟踪</h3><p>使用 Cookie 最大的优势是可跨站设置、同站共享、跨站请求自动携带。这也是为什么利用 Cookie 进行用户行为跟踪最佳选择：</p><ol><li>通过透明小图片等方法访问第三方网站以便植入 Cookie 标记身份、记录行为</li><li>通过跨站请求自动携带第三方 Cookie 数据传送到第三方网站</li></ol><blockquote><p><a href="https://zh.javascript.info/cookie#fu-lu-di-san-fang-cookie" target="_blank" rel="noopener noreferrer">附录：第三方 cookie<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><blockquote><p><a href="https://mp.weixin.qq.com/s?__biz=Mzk0MDMwMzQyOA==&amp;mid=2247490361&amp;idx=1&amp;sn=ebc8dcc4d095cc7ba748827dff158f2b&amp;source=41#wechat_redirect" target="_blank" rel="noopener noreferrer">当浏览器全面禁用三方 Cookie<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>当第三方 Cookie 被全面禁止时，</p><ol><li>使用一方 Cookie 替代三方 Cookie</li><li>Cookie 数据携带改成请求参数</li><li>一方 Cookie 的数据无法获取，将数据改为后端记录</li></ol><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2><ul><li><a href="https://zh.javascript.info/cookie" target="_blank" rel="noopener noreferrer">Cookie，document.cookie<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></div><!----></article></div><footer class="footer footer-center p-4 bg-base-300 text-base-content opacity-60"><div><p>©2017-2021 laoergege.cn. All right reserved. </p><p><a href="https://beian.miit.gov.cn" target="_blank" class="link link-hover">粤ICP备2022020679号</a></p></div></footer><!--]--><!----><!--]--></div>
    <script src="/assets/js/runtime~app.7d4bd660.js" defer></script><script src="/assets/js/5838.13a569e5.js" defer></script><script src="/assets/js/app.7e792774.js" defer></script>
</body>

</html>