"use strict";(self.webpackChunklaoergege_blog=self.webpackChunklaoergege_blog||[]).push([[8592],{2652:(s,l,a)=>{a.r(l),a.d(l,{data:()=>n});const n={key:"v-f701b528",path:"/%E5%8F%AF%E8%A7%86%E5%8C%96/Canvas.html",title:"Canvas",lang:"zh-CN",frontmatter:{release:!0,tags:["canvas","可视化"]},excerpt:"",headers:[{level:2,title:"画布及坐标系",slug:"画布及坐标系",children:[{level:3,title:"坐标系",slug:"坐标系",children:[]}]},{level:2,title:"路径",slug:"路径",children:[{level:3,title:"描绘路径",slug:"描绘路径",children:[]},{level:3,title:"绘制路径",slug:"绘制路径",children:[]}]},{level:2,title:"绘制图像",slug:"绘制图像",children:[{level:3,title:"裁剪、合成",slug:"裁剪、合成",children:[]}]},{level:2,title:"动画",slug:"动画",children:[]},{level:2,title:"Canvas 高清适配",slug:"canvas-高清适配",children:[]}],git:{createdTime:1639757468e3,updatedTime:1640448032e3,contributors:[{name:"连远生",email:"lianyuansheng@xiao100.com",commits:2}]}}},8638:(s,l,a)=>{a.r(l),a.d(l,{default:()=>D});var n=a(5393);const e=a.p+"assets/img/iShot2020-07-08pm11.20.08.45438b27.png",p=(0,n._)("h1",{id:"canvas",tabindex:"-1"},[(0,n._)("a",{class:"header-anchor",href:"#canvas","aria-hidden":"true"},"#"),(0,n.Uk)(" Canvas")],-1),o=(0,n._)("p",null,[(0,n.Uk)("Canvas API 提供了一个通过JavaScript 和 HTML的 "),(0,n._)("code",null,"<canvas>"),(0,n.Uk)(" 元素来绘制图形的方式，相比较浏览器 HTML 的声明式渲染页面方式，Canvas 更像似更接近底层，在系统图形绘制指令上封装的一套绘制指令系统。")],-1),t=(0,n._)("p",null,"Canvas API 支持",-1),r={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D",target:"_blank",rel:"noopener noreferrer"},c=(0,n.Uk)("CanvasRenderingContext2D"),i=(0,n.Uk)(" 接口的2D渲染"),y={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL2RenderingContext",target:"_blank",rel:"noopener noreferrer"},u=(0,n.Uk)("WebGL2RenderingContext"),d=(0,n.Uk)(" 接口的硬件加速的 2D、3D 渲染"),h=(0,n.uE)('<blockquote><p>本文主要以 CanvasRenderingContext2D 渲染为主</p></blockquote><ul><li>canvas <ul><li>基础 <ul><li>画布及坐标系 <ul><li>画布跟坐标系初始重叠</li></ul></li><li>绘制指令 <ul><li>状态 <ul><li>save 和 restore</li><li>色彩</li><li>透明</li><li>线条</li></ul></li><li>图形 <ul><li><a href="#%E8%B7%AF%E5%BE%84">路径</a></li><li>文本</li><li>图像</li></ul></li><li>坐标系变换 <ul><li>没有 transform-origin</li></ul></li></ul></li><li>二次贝塞尔曲线及三次贝塞尔曲线</li></ul></li><li>进阶 <ul><li>事件交互 <ul><li>凸包算法</li><li>isPointInPath + 包围盒</li></ul></li><li>动画</li><li>优化 <ul><li>Path2D 缓存或记录绘画指令</li></ul></li></ul></li><li>常见问题 <ul><li>Canvas 高清适配</li><li>Canvas 跨域</li></ul></li></ul></li></ul><h2 id="画布及坐标系" tabindex="-1"><a class="header-anchor" href="#画布及坐标系" aria-hidden="true">#</a> 画布及坐标系</h2><div class="language-html ext-html"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292F;">&lt;</span><span style="color:#116329;">script</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">type</span><span style="color:#24292F;">=</span><span style="color:#0A3069;">&quot;text/javascript&quot;</span><span style="color:#24292F;">&gt;</span></span>\n<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">function</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">draw</span><span style="color:#24292F;">() {</span></span>\n<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> canvas </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> document.</span><span style="color:#8250DF;">getElementById</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&#39;tutorial&#39;</span><span style="color:#24292F;">);</span></span>\n<span class="line"><span style="color:#24292F;">        </span><span style="color:#CF222E;">if</span><span style="color:#24292F;"> (canvas.getContext) {</span></span>\n<span class="line"><span style="color:#24292F;">            </span><span style="color:#CF222E;">var</span><span style="color:#24292F;"> ctx </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> canvas.</span><span style="color:#8250DF;">getContext</span><span style="color:#24292F;">(</span><span style="color:#0A3069;">&#39;2d&#39;</span><span style="color:#24292F;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#24292F;">            ctx.fillColor </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&#39;yellow&#39;</span></span>\n<span class="line"><span style="color:#24292F;">            ctx.</span><span style="color:#8250DF;">fillRect</span><span style="color:#24292F;">(</span><span style="color:#0550AE;">0</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">0</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">150</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">150</span><span style="color:#24292F;">)</span></span>\n<span class="line"><span style="color:#24292F;">        }</span></span>\n<span class="line"><span style="color:#24292F;">    }</span></span>\n<span class="line"><span style="color:#24292F;">&lt;/</span><span style="color:#116329;">script</span><span style="color:#24292F;">&gt;</span></span>\n<span class="line"><span style="color:#24292F;">&lt;</span><span style="color:#116329;">style</span><span style="color:#24292F;">&gt;</span></span>\n<span class="line"><span style="color:#24292F;">    </span><span style="color:#116329;">canvas</span><span style="color:#24292F;"> {</span></span>\n<span class="line"><span style="color:#24292F;">        </span><span style="color:#0550AE;">width</span><span style="color:#24292F;">: </span><span style="color:#0550AE;">300</span><span style="color:#CF222E;">px</span><span style="color:#24292F;">;</span></span>\n<span class="line"><span style="color:#24292F;">        </span><span style="color:#0550AE;">height</span><span style="color:#24292F;">: </span><span style="color:#0550AE;">300</span><span style="color:#CF222E;">px</span><span style="color:#24292F;">;</span></span>\n<span class="line"><span style="color:#24292F;">    }</span></span>\n<span class="line"><span style="color:#24292F;">&lt;/</span><span style="color:#116329;">style</span><span style="color:#24292F;">&gt;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#24292F;">&lt;</span><span style="color:#116329;">body</span><span style="color:#24292F;">&gt;</span></span>\n<span class="line"><span style="color:#24292F;">    &lt;</span><span style="color:#116329;">canvas</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">id</span><span style="color:#24292F;">=</span><span style="color:#0A3069;">&quot;tutorial&quot;</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">width</span><span style="color:#24292F;">=</span><span style="color:#0A3069;">&quot;150&quot;</span><span style="color:#24292F;"> </span><span style="color:#0550AE;">height</span><span style="color:#24292F;">=</span><span style="color:#0A3069;">&quot;150&quot;</span><span style="color:#24292F;">&gt;请升级最新浏览器&lt;</span><span style="color:#116329;">canvas</span><span style="color:#24292F;">&gt;</span></span>\n<span class="line"><span style="color:#24292F;">&lt;/</span><span style="color:#116329;">body</span><span style="color:#24292F;">&gt;</span></span>\n<span class="line"></span></code></pre></div><p>Canvas <strong>元素及画布</strong>的默认大小为一致，且为 300像素×150像素（宽×高，像素的单位是px），可通过 css 样式去改变 canvas 元素在页面布局的大小，画布内容会自适应元素大小</p><p><img src="'+e+'" alt=""></p><p>上面案例中，我们画布大小为 150 <em>150，元素大小 300</em> 300，最后图像自适应填充了整个元素大小</p><blockquote><p>注意：如果CSS的尺寸与初始画布的比例不一致，它会出现扭曲</p></blockquote><h3 id="坐标系" tabindex="-1"><a class="header-anchor" href="#坐标系" aria-hidden="true">#</a> 坐标系</h3><p>在画布中所有元素的位置都是在按照以左上角位置为原点（0，0），y 轴向下的坐标系中</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANwAAADcCAMAAAAshD+zAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAABgUExURQAAACYmJn5+fry8vOrq6kNDQ9zc3I6Ojm5ubp2dna2trVtbW87OzsjIyO/v7////zJfofb29v7+/uXl5ff39/39/fj4+Pz8/Pn5+fr6+szMzPv7+6enp+fn59DQ0PT09O486JcAAAQQSURBVHja7N2JjtowEAZgXzPkIi5H2wANvP9b1uFYtZtAE661p/8v8GqjCPxp7JhYK1Z5wVHAAQcccMABB5wAXON4v004e3bNNdyB2R0WCefgmA/DuIbbRfJpuRnEOV4ICLtBHDsJOMeDuP1BAu6wH8RtFyKyBS5ceoiolYqj+WJOQnFtB0uudCNx1oTGWKG4LDSZUNxCn58icXlpy1zsOmeTm3EjcOkscG0YWXY+CZfQAkfz9u86XMGtL2kpNNSuUwiTyf868C+cNaExNjQqWpS6dM3QehouC01mu1eIOsfOlnoabq3Pz/XQ5tjq9jE18rz7j/36s3KWZmYa7rjAxY27hHit20m4MOvs+j5cGC3vxBXmPIsm4D6mbey4fl6Je/ewBA444IADDjjggAMOOOCAux+36qe6fUyNPO/+Y6gccCPfmCvvaxsx7kc/43Gq9qZ8E+7HrbwA50vjNUvFsZqRl4rzpbJycTl5uThdyMVZ7eXiTCEY985PKMABBxxwwAH3JFyUeyio3L24uqi9raTOubKsdGK4pp8ruFqr/AuHZXMrD+P8TNdicYUqtVRcpaow7YY7844/j3pt5erjQyjui9e5J+KUGv3G3akJ4abn2/2Jv3Jp4SYOI+CAAw444IThpu95PIAbu4fyP1RuLheXG21CeCRu00+cuGPXLrjPXRaBuxbg4seZ7g7LCsVpJ7hyJHVYZkSkdWi2AnFbe47D1RK4qHCn3bbPs04ILrObLW0siV0KjN3IxGneOGKnReIKTcrkqpB5tXSWN+ywFAziotxDOY5JszFTblZ3/cRZua5nhdmdcJ+7LAF3NcDFj2NSnEnFkaUdSZ1zgbYzVm7lWDuhuC0pXeBqCVxcuIK63S+hOF10u19ilwKhwzIPn5l1KfSDc27OwV2BdNzPfuLE/bwV4E64KPdQUDnggAMOOOCAA24i7vXHgAMOOOCAexnuez9x4r7fCnD/Ae5V32ny0PehoHLAAQcccMABBxxwwAEHHHDAicAt+4kTt7wV4E64KPdQUDnggAMOOOCA+zfuV4x5Fm6ZXIADbmKsPf00MeCUepLugjKvHxBvx1Wq+sDlHAnu2b3ocGRF4Gx2nF35LIjCrzMqMxOKqMPLGjJfj3ssimtVLPWpVDnVrC+Vs7XmxHGmnGnK6TQCOtQfw5Js4rha6Up3hes0Zb5cZvHgwlxZcvFQ6ah7nHBWF7mKCNd1pXqodMWyzi+rNpu8W8S7peC8IrwT17vJoNpmPrWMxdny03+okYTzZe7l4owFDrjocCkGOOCAiwG330mw7faDOK4l4GoexLmVBNzKDeIadunbHDeDOH/gVZ30vNvVKz74YZxvHO+3CWfPrvHXcNICHHDAAQcccMAlmt8CDABIbErQtEaWvQAAAABJRU5ErkJggg==" alt="Canvas_default_grid"></p><h2 id="路径" tabindex="-1"><a class="header-anchor" href="#路径" aria-hidden="true">#</a> 路径</h2><p>Canvas 只提供矩形绘制的 API（fillRect、strokeRect），其他复杂的图形需要我们自己绘制路径形成。</p><p><strong>路径是有一条或多条直线、曲线形成；而图形都是通过一条或者多条路径闭合形成的</strong></p><p>创建图形的步骤如下：</p><h3 id="描绘路径" tabindex="-1"><a class="header-anchor" href="#描绘路径" aria-hidden="true">#</a> 描绘路径</h3>',16),A=(0,n.Uk)("CanvasRenderingContext2D 提供了一些"),F={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D#%E8%B7%AF%E5%BE%84",target:"_blank",rel:"noopener noreferrer"},g=(0,n.Uk)("描绘路径方法列表"),v=(0,n.Uk)("，其中："),C=(0,n.uE)("<ul><li><p>beginPath 声明开始创建路径</p><p>路径是由很多子路径构成，这些子路径都是在一个<strong>列表</strong>中，所有的子路径（线、弧形、等等）构成图形。而每次这个方法调用之后，列表清空重置，然后我们就可以重新绘制新的图形。</p></li><li><p>moveTo 确定路径起点</p></li><li><p>lineTo 直线连接坐标</p></li><li><p>closePath 闭合路径</p><p>closePath 会通过绘制一条从当前点到开始点的直线来闭合图形。以 fill 填充方式绘制路径，会自动闭合。</p></li></ul>",1),f=(0,n.Uk)("还有其他生成路径的，如线型 lineTo、贝赛尔曲线型 bezierCurveTo、圆型 arcTo 等，请参考"),b={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D#%E8%B7%AF%E5%BE%84",target:"_blank",rel:"noopener noreferrer"},x=(0,n.Uk)("文档"),m=(0,n.Uk)("。"),E=(0,n.uE)('<h3 id="绘制路径" tabindex="-1"><a class="header-anchor" href="#绘制路径" aria-hidden="true">#</a> 绘制路径</h3><p>描绘完路径后，就需要把路径绘制到屏幕上，主要有两种方式 stroke 描边和 fill 填充的方式将路径绘制到画布中。</p><h2 id="绘制图像" tabindex="-1"><a class="header-anchor" href="#绘制图像" aria-hidden="true">#</a> 绘制图像</h2><h3 id="裁剪、合成" tabindex="-1"><a class="header-anchor" href="#裁剪、合成" aria-hidden="true">#</a> 裁剪、合成</h3><h2 id="动画" tabindex="-1"><a class="header-anchor" href="#动画" aria-hidden="true">#</a> 动画</h2><h2 id="canvas-高清适配" tabindex="-1"><a class="header-anchor" href="#canvas-高清适配" aria-hidden="true">#</a> Canvas 高清适配</h2>',6),k={},D=(0,a(3860).Z)(k,[["render",function(s,l){const a=(0,n.up)("ExternalLinkIcon");return(0,n.wg)(),(0,n.iD)("div",null,[p,o,t,(0,n._)("ul",null,[(0,n._)("li",null,[(0,n._)("a",r,[c,(0,n.Wm)(a)]),i]),(0,n._)("li",null,[(0,n._)("a",y,[u,(0,n.Wm)(a)]),d])]),h,(0,n._)("p",null,[A,(0,n._)("a",F,[g,(0,n.Wm)(a)]),v]),C,(0,n._)("p",null,[f,(0,n._)("a",b,[x,(0,n.Wm)(a)]),m]),E])}]])},3860:(s,l)=>{l.Z=(s,l)=>{const a=s.__vccOpts||s;for(const[s,n]of l)a[s]=n;return a}}}]);