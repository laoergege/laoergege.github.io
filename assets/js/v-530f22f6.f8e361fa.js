"use strict";(self.webpackChunklaoergege_blog=self.webpackChunklaoergege_blog||[]).push([[7243],{3665:(e,l,o)=>{o.r(l),o.d(l,{data:()=>i});const i={key:"v-530f22f6",path:"/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E5%8F%8AWebAPI/Web%20%E5%AD%98%E5%82%A8.html",title:"Web 存储",lang:"zh-CN",frontmatter:{release:!0,tags:["web","cookie","storage"]},excerpt:"",headers:[{level:2,title:"JavaScritpt 中的 cookie 操作",slug:"javascritpt-中的-cookie-操作",children:[]},{level:2,title:"如何处理多个同名 Cookie",slug:"如何处理多个同名-cookie",children:[]},{level:2,title:"第三方 Cookie",slug:"第三方-cookie",children:[{level:3,title:"行为跟踪",slug:"行为跟踪",children:[]}]},{level:2,title:"参考",slug:"参考",children:[]}],git:{createdTime:1663867943e3,updatedTime:1664724638e3,contributors:[{name:"连远生",email:"lianyuansheng@xiao100.com",commits:2}]}}},1498:(e,l,o)=>{o.r(l),o.d(l,{default:()=>L});var i=o(5393);const a=(0,i._)("h1",{id:"web-存储",tabindex:"-1"},[(0,i._)("a",{class:"header-anchor",href:"#web-存储","aria-hidden":"true"},"#"),(0,i.Uk)(" Web 存储")],-1),r={href:"https://web.dev/storage-for-the-web/#%E5%A4%9A%E5%B0%91",target:"_blank",rel:"noopener noreferrer"},t=(0,i.Uk)("客户端存储限额及检查"),n=(0,i.Uk)("Web 存储 "),c=(0,i.Uk)("Cookie "),u=(0,i.uE)("<li>大小、数量：不超过 4K，每个域下最多允许有 20+ 个左右的 cookie</li><li>生命周期 <ul><li>Expires 绝对过期时间</li><li>MaxAge 相对过期时间，单位是秒，浏览器用收到报文的时间点再加上 Max-Age，就可以得到失效的绝对时间；优先级比 Expires 高；MaxAge = 0 会话结束过期</li></ul></li><li>作用范围：控制 Cookie 的可见范围，可同站共享 <ul><li>Domain <ul><li>默认为当前文档域名</li><li>但默认情况下，Cookie 只有显示设置的域下才能被子域共享访问</li><li>如果 Set-Cookie 的 Domain 跟请求源不是同站，则代理会拒绝设置</li><li>document.cookie 设置了 cookie，那么无论脚本来自何处，这个 cookie 都属于当前网页的域</li></ul></li><li>Path <ul><li>默认为当前路径</li></ul></li></ul></li><li>安全 <ul><li>HttpOnly：不允许 js 操作，以防范跨站脚本攻击（XSS）</li><li>Secure：只允许通过 HTTPS 安全协议通道发送给服务器</li><li>SameSite：防止跨站请求时被发送 Cookie，从而可以阻止跨站请求伪造攻击（CSRF） <ul><li>Strict：严格禁止在跨站请求时发送 cookie</li><li>Lax（默认）：禁止在跨站请求时发送 cookie，除非 <ul><li>HTTP 方法是“安全的”（&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;, and &quot;TRACE&quot;）</li><li>顶层导航（更改浏览器地址栏中的 URL）</li></ul></li><li>None：允许跨站请求时发送 cookie <ul><li>具有<code>SameSite=None</code> 的 cookie 还必须指定 Secure</li></ul></li></ul></li><li>SameParty</li></ul></li>",4),s=(0,i.Uk)("其他 "),k=(0,i._)("li",null,[(0,i._)("a",{href:"#javascritpt-%E4%B8%AD%E7%9A%84-cookie-%E6%93%8D%E4%BD%9C"},"JavaScritpt 中的 cookie 操作"),(0,i._)("ul",null,[(0,i._)("li",null,"Cookie Store API")])],-1),d=(0,i._)("li",null,[(0,i._)("a",{href:"#%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%A4%9A%E4%B8%AA%E5%90%8C%E5%90%8D-cookie"},"如何处理多个同名 Cookie")],-1),h=(0,i._)("li",null,[(0,i._)("a",{href:"#%E7%AC%AC%E4%B8%89%E6%96%B9-cookie"},"第三方 Cookie")],-1),p={href:"https://web.dev/samesite-cookie-recipes/#%E5%A4%84%E7%90%86%E4%B8%8D%E5%85%BC%E5%AE%B9%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF",target:"_blank",rel:"noopener noreferrer"},_=(0,i.Uk)("部署 SameSite 及兼容处理"),f=(0,i.uE)("<li>LocalStorage、SessionStorage <ul><li>大小：限制为 5MB+，具体取决于浏览器</li><li>生命周期 <ul><li>LocalStorage：永久</li><li>SessionStorage：页面关闭即失效</li></ul></li><li>其他 <ul><li>可监听 storage 事件</li></ul></li></ul></li><li>IndexDB <ul><li>大小：一般不少于 250 MB</li><li>生命周期：永久</li><li>其他 <ul><li>能够在 Web Worker 及 Service Worker 环境下访问</li></ul></li></ul></li><li>CacheStorage、CacheAPI <ul><li>大小：一般不少于 250 MB</li><li>生命周期：永久</li><li>其他 <ul><li>能够在 Web Worker 及 Service Worker 环境下访问</li></ul></li></ul></li>",3),E={href:"https://web.dev/bfcache/?utm_source=devtools",target:"_blank",rel:"noopener noreferrer"},g=(0,i.Uk)("Back/forward cache"),b=(0,i._)("li",null,"HTTP Cache",-1),C=(0,i.uE)('<h2 id="javascritpt-中的-cookie-操作" tabindex="-1"><a class="header-anchor" href="#javascritpt-中的-cookie-操作" aria-hidden="true">#</a> JavaScritpt 中的 cookie 操作</h2><p><code>document.cookie</code> 能够获取仅对当前页面可用的 cookie，每条 cookie 以&quot;分号和空格 (; )&quot;分隔，结果如下</p><div class="language-text ext-text"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292f;">name1=value1; name2=value2</span></span>\n<span class="line"><span style="color:#24292f;"></span></span></code></pre></div><p>写入 cookie 时，键值必须通过 <code>encodeURIComponent()</code> (en-US)来保证它不包含任何逗号、分号或空格 (cookie 值中禁止使用这些值)：</p><div class="language-text ext-text"><pre class="shiki" style="background-color:#ffffff;"><code><span class="line"><span style="color:#24292f;">document.cookie = encodeURIComponent(&quot;name&quot;) + &#39;=&#39; + encodeURIComponent(&quot;value&quot;)</span></span>\n<span class="line"><span style="color:#24292f;"></span></span></code></pre></div><h2 id="如何处理多个同名-cookie" tabindex="-1"><a class="header-anchor" href="#如何处理多个同名-cookie" aria-hidden="true">#</a> 如何处理多个同名 Cookie</h2><blockquote><p>参考 https://httpwg.org/specs/rfc6265.html#storage-model 5.3 存储模型章节第 11 小点</p></blockquote><ol><li>客户端代理将同名、同域、同路径的当作同一 Cookie</li><li>如果重复设置相同 Cookie 则会替换更新，否则存入新的 Cookie 值</li></ol><h2 id="第三方-cookie" tabindex="-1"><a class="header-anchor" href="#第三方-cookie" aria-hidden="true">#</a> 第三方 Cookie</h2>',9),m=(0,i.Uk)("如果 cookie 的注册域与当前页面 URL 的 "),A={href:"https://web.dev/same-site-same-origin/",target:"_blank",rel:"noopener noreferrer"},v=(0,i.Uk)("eTLD+1"),S=(0,i.Uk)(" 相匹配，则认为 cookie 与页面来自同一站点，通常称为第一方 cookie，不同站点的则称为第三方 cookie。"),x=(0,i._)("h3",{id:"行为跟踪",tabindex:"-1"},[(0,i._)("a",{class:"header-anchor",href:"#行为跟踪","aria-hidden":"true"},"#"),(0,i.Uk)(" 行为跟踪")],-1),U=(0,i._)("p",null,"使用 Cookie 最大的优势是可跨站设置、同站共享、跨站请求自动携带。这也是为什么利用 Cookie 进行用户行为跟踪最佳选择：",-1),q=(0,i._)("ol",null,[(0,i._)("li",null,"通过透明小图片等方法访问第三方网站以便植入 Cookie 标记身份、记录行为"),(0,i._)("li",null,"通过跨站请求自动携带第三方 Cookie 数据传送到第三方网站")],-1),B={href:"https://zh.javascript.info/cookie#fu-lu-di-san-fang-cookie",target:"_blank",rel:"noopener noreferrer"},W=(0,i.Uk)("附录：第三方 cookie"),w={href:"https://mp.weixin.qq.com/s?__biz=Mzk0MDMwMzQyOA==&mid=2247490361&idx=1&sn=ebc8dcc4d095cc7ba748827dff158f2b&source=41#wechat_redirect",target:"_blank",rel:"noopener noreferrer"},D=(0,i.Uk)("当浏览器全面禁用三方 Cookie"),T=(0,i._)("p",null,"当第三方 Cookie 被全面禁止时，",-1),y=(0,i._)("ol",null,[(0,i._)("li",null,"使用一方 Cookie 替代三方 Cookie"),(0,i._)("li",null,"Cookie 数据携带改成请求参数"),(0,i._)("li",null,"一方 Cookie 的数据无法获取，将数据改为后端记录")],-1),M=(0,i._)("h2",{id:"参考",tabindex:"-1"},[(0,i._)("a",{class:"header-anchor",href:"#参考","aria-hidden":"true"},"#"),(0,i.Uk)(" 参考")],-1),I={href:"https://zh.javascript.info/cookie",target:"_blank",rel:"noopener noreferrer"},P=(0,i.Uk)("Cookie，document.cookie"),j={},L=(0,o(3860).Z)(j,[["render",function(e,l){const o=(0,i.up)("ExternalLinkIcon");return(0,i.wg)(),(0,i.iD)("div",null,[a,(0,i._)("ul",null,[(0,i._)("li",null,[(0,i._)("a",r,[t,(0,i.Wm)(o)])]),(0,i._)("li",null,[n,(0,i._)("ul",null,[(0,i._)("li",null,[c,(0,i._)("ul",null,[u,(0,i._)("li",null,[s,(0,i._)("ul",null,[k,d,h,(0,i._)("li",null,[(0,i._)("a",p,[_,(0,i.Wm)(o)])])])])])]),f,(0,i._)("li",null,[(0,i._)("a",E,[g,(0,i.Wm)(o)])]),b])])]),C,(0,i._)("p",null,[m,(0,i._)("a",A,[v,(0,i.Wm)(o)]),S]),x,U,q,(0,i._)("blockquote",null,[(0,i._)("p",null,[(0,i._)("a",B,[W,(0,i.Wm)(o)])])]),(0,i._)("blockquote",null,[(0,i._)("p",null,[(0,i._)("a",w,[D,(0,i.Wm)(o)])])]),T,y,M,(0,i._)("ul",null,[(0,i._)("li",null,[(0,i._)("a",I,[P,(0,i.Wm)(o)])])])])}]])},3860:(e,l)=>{l.Z=(e,l)=>{const o=e.__vccOpts||e;for(const[e,i]of l)o[e]=i;return o}}}]);